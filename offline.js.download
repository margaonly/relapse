(function(g){var window=this;'use strict';var Q8K=function(h){var W=new g.a7("und",new g.Uj("Default","und",!0));W.captionTracks=h.captionTracks;return W},LL6=function(h){return new g.iZ(function(W,c){var V=h.length,H=[];
if(V)for(var B=function(d,G){V--;H[d]=G;V==0&&W(H)},E=function(d){c(d)},J,u=0;u<h.length;u++)J=h[u],g.OJ5(J,g.uK(B,u),E);
else W(H)})},Tl=function(h){this.X=h},N5=function(){Tl.apply(this,arguments)},iR2=function(){N5.apply(this,arguments)},KL2=function(){N5.apply(this,arguments)},AbU=function(){N5.apply(this,arguments)},UY6=function(){N5.apply(this,arguments)},COU=function(){N5.apply(this,arguments)},Mel=function(){N5.apply(this,arguments)},FLl=function(){N5.apply(this,arguments)},ybI=function(){Tl.apply(this,arguments)},PO$=function(){N5.apply(this,arguments)},fkI=function(){N5.apply(this,arguments)},bRI=function(){N5.apply(this,
arguments)},Tx$=function(){N5.apply(this,arguments)},NxK=function(){N5.apply(this,arguments)},XUU=function(){N5.apply(this,arguments)},te2=function(){N5.apply(this,arguments)},vf$=function(){N5.apply(this,arguments)},mYI=function(){N5.apply(this,arguments)},ofU=function(){N5.apply(this,arguments)},pUU=function(){N5.apply(this,arguments)},Ik6=function(){N5.apply(this,arguments)},YTl=function(){Tl.apply(this,arguments)},ORl=function(){N5.apply(this,arguments)},STX=function(){N5.apply(this,arguments)},
gf2=function(){N5.apply(this,arguments)},DYX=function(){N5.apply(this,arguments)},wUc=function(){N5.apply(this,arguments)},kuK=function(){N5.apply(this,arguments)},hht=function(){N5.apply(this,arguments)},WmU=function(){N5.apply(this,arguments)},cHU=function(){N5.apply(this,arguments)},Vxt=function(){Tl.apply(this,arguments)},$$6=function(){Tl.apply(this,arguments)},sH6=function(){Tl.apply(this,arguments)},H2X=function(){N5.apply(this,arguments)},B5U=function(){N5.apply(this,arguments)},E7f=function(){N5.apply(this,
arguments)},Rhc=function(){N5.apply(this,arguments)},JHX=function(){N5.apply(this,arguments)},u7$=function(){N5.apply(this,arguments)},d$U=function(){N5.apply(this,arguments)},Gd2=function(){N5.apply(this,arguments)},Z2I=function(){N5.apply(this,arguments)},rHS=function(){N5.apply(this,arguments)},q$6=function(){N5.apply(this,arguments)},x$2=function(){N5.apply(this,arguments)},lPf=function(){N5.apply(this,arguments)},n7U=function(){N5.apply(this,arguments)},jHS=function(){N5.apply(this,arguments)},
aPS=function(){N5.apply(this,arguments)},ehu=function(){N5.apply(this,arguments)},zhS=function(){N5.apply(this,arguments)},QH6=function(){N5.apply(this,arguments)},Lmc=function(){N5.apply(this,arguments)},i26=function(){N5.apply(this,arguments)},Km2=function(){N5.apply(this,arguments)},AHU=function(){N5.apply(this,arguments)},U$l=function(){N5.apply(this,arguments)},CH6=function(){N5.apply(this,arguments)},MxU=function(){N5.apply(this,arguments)},FmU=function(){N5.apply(this,arguments)},yHX=function(){Tl.apply(this,
arguments)},PHU=function(){N5.apply(this,arguments)},fPc=function(){N5.apply(this,arguments)},b2S=function(){N5.apply(this,arguments)},T5U=function(){N5.apply(this,arguments)},N5f=function(){N5.apply(this,arguments)},XeU=function(){N5.apply(this,arguments)},txU=function(){N5.apply(this,arguments)},v7l=function(){N5.apply(this,arguments)},m$U=function(){N5.apply(this,arguments)},o76=function(){N5.apply(this,arguments)},pel=function(){N5.apply(this,arguments)},IP6=function(){N5.apply(this,arguments)},
Y$f=function(){N5.apply(this,arguments)},O2$=function(){N5.apply(this,arguments)},S$6=function(){N5.apply(this,arguments)},g7K=function(){N5.apply(this,arguments)},D$X=function(){N5.apply(this,arguments)},wel=function(){N5.apply(this,arguments)},kdl=function(){N5.apply(this,arguments)},hXI=function(){N5.apply(this,arguments)},W32=function(){N5.apply(this,arguments)},cF2=function(){N5.apply(this,arguments)},VaK=function(){N5.apply(this,arguments)},$d6=function(){N5.apply(this,arguments)},snf=function(){N5.apply(this,
arguments)},HW$=function(){N5.apply(this,arguments)},BmU=function(){N5.apply(this,arguments)},Evf=function(){N5.apply(this,arguments)},RXX=function(){N5.apply(this,arguments)},JF2=function(){N5.apply(this,arguments)},uvc=function(){N5.apply(this,arguments)},ddU=function(){N5.apply(this,arguments)},Gsl=function(){N5.apply(this,arguments)},ZWU=function(h){h=h.key||h.id;
if(!h)throw Error("Entity key is missing");return h},rF$=function(){if(X3)return X3();
var h={};X3=g.OG("PersistentEntityStoreDb",{iP:(h.EntityStore={vp:1},h.EntityAssociationStore={vp:2},h),shared:!1,upgrade:function(W,c){c(1)&&g.UG(g.z1(W,"EntityStore",{keyPath:"key"}),"entityType","entityType");c(2)&&(W=g.z1(W,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.UG(W,"byParentEntityKey","parentEntityKey"),g.UG(W,"byChildEntityKey","childEntityKey"))},
version:3});return X3()},qLI=function(h){return g.T1(rF$(),h)},xd6=function(h){return g.T1((0,g.w3u)(),h)},td=function(h){this.token=h},vi=function(h,W){W=W===void 0?{}:W;
g.tP.call(this,g.kCK[h],Object.assign({},{name:"PESEncoderError",type:h},W));this.type=h;this.level="WARNING";Object.setPrototypeOf(this,vi.prototype)},l9u=function(h){return new vi("WRONG_DATA_TYPE",{d4:h})},nv6=function(h){return h instanceof Error?new vi("UNKNOWN_ENCODE_ERROR",{originalMessage:h.message}):new vi("UNKNOWN_ENCODE_ERROR")},jnX=function(h){return h instanceof Error?new vi("UNKNOWN_DECODE_ERROR",{originalMessage:h.message}):new vi("UNKNOWN_DECODE_ERROR")},a9X=function(h,W){h=h instanceof
vi?h:W(h);
g.Qq(h);throw h;},eX2=function(){},zX6=function(h,W,c){try{return h.G(W,c)}catch(V){a9X(V,nv6)}},Qn6=function(h){h=(new TextEncoder).encode(h).subarray(0,16);
var W=new Uint8Array(16);W.set(h);return W},mp=function(h){this.X=h},iWU=function(h){var W=L3K[h];
if(W)return W;g.Lx(new g.tP("Entity model not found.",{entityType:h}))},K3l=function(h,W){this.X=h;
this.W=W;this.G={}},Udf=function(h,W){a:{h=AF2(h.W,W.version);
try{var c=h.W(W.data,W.key);break a}catch(V){a9X(V,jnX)}c=void 0}return c},oh=function(h,W,c){return h.X.objectStore("EntityStore").get(W).then(function(V){if(V){if(c&&V.entityType!==c)throw Error("Incorrect entity type");
return Udf(h,V)}})},ph=function(h,W,c){return c?(c=c.map(function(V){return oh(h,V,W)}),g.x4.all(c)):h.X.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(W)).then(function(V){return V.map(function(H){return Udf(h,H)})})},Yi=function(h,W,c){var V=ZWU(W),H=AF2(h.W,1),B=Object.assign({},W);
return h.X.objectStore("EntityStore").get(V).then(function(E){if(E){if(E.entityType!==c)throw Error("Incorrect entity type");B.entityMetadata||(E=Udf(h,E),B.entityMetadata=E.entityMetadata)}}).then(function(){var E={key:V,
entityType:c,data:zX6(H,B,V),version:1};return g.x4.all([g.iC(h.X.objectStore("EntityStore"),E),CZ6(h,B,c)])}).then(function(){Ih(h,V,c);
return V})},MaI=function(h,W,c){W=W.map(function(V){return Yi(h,V,c)});
return g.x4.all(W)},O3=function(h,W,c){if(c==null?0:c.ow){var V=new Set;
return F3t(h,W,V).then(function(){for(var B=[],E=g.e(V),J=E.next();!J.done;J=E.next())B.push(O3(h,J.value));return g.x4.all(B).then(function(){})})}var H=g.pP(W).entityType;
return g.x4.all([h.X.objectStore("EntityStore").delete(W),yF2(h,W)]).then(function(){Ih(h,W,H)})},PZ6=function(h,W){return g.y5(h.X.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(W)},function(c){return g.x4.all([c.delete(),
yF2(h,c.cursor.primaryKey)]).then(function(){Ih(h,c.cursor.primaryKey,W);return g.Mv(c)})})},f9S=function(h,W,c,V){var H=AF2(h.W,1);
return oh(h,W,V).then(function(B){if(B){B=g.k9(B,c);var E={key:W,entityType:V,data:zX6(H,B,W),version:1};return g.x4.all([g.iC(h.X.objectStore("EntityStore"),E),CZ6(h,B,V)])}}).then(function(){Ih(h,W,V);
return W})},Ih=function(h,W,c){var V=h.G[c];
V||(V=new Set,h.G[c]=V);V.add(W)},bW2=function(h,W,c){var V=ZWU(W);
c=iWU(c);if(!c)return g.x4.resolve([]);c=new c(W);h=h.X.objectStore("EntityAssociationStore");W=[];c=g.e(c.W());for(var H=c.next();!H.done;H=c.next())W.push(g.iC(h,{parentEntityKey:V,childEntityKey:H.value}));return g.x4.all(W).then(function(B){return B.map(function(E){return E[1]})})},yF2=function(h,W){return h.X.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(W))},CZ6=function(h,W,c){var V=ZWU(W);
return yF2(h,V).then(function(){return bW2(h,W,c)})},F3t=function(h,W,c){if(c.has(W))return g.x4.resolve(void 0);
c.add(W);return TmX(h,W).then(function(V){return h.X.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(W)).then(function(){return V})}).then(function(V){var H=g.x4.resolve(void 0);
V=g.e(V);for(var B=V.next(),E={};!B.done;E={z9:void 0},B=V.next())E.z9=B.value,H=H.then(function(J){return function(){return F3t(h,J.z9,c)}}(E));
return H}).then(function(){})},TmX=function(h,W){var c=h.X.objectStore("EntityAssociationStore");
return c.index("byParentEntityKey").getAll(IDBKeyRange.only(W)).then(function(V){var H=[];V=g.e(V);for(var B=V.next();!B.done;B=V.next())B=B.value,H.push(c.index("byChildEntityKey").getAll(B.childEntityKey));return g.x4.all(H)}).then(function(V){var H=[];
V=g.e(V);for(var B=V.next();!B.done;B=V.next())B=B.value,B.length===1&&H.push(B[0].childEntityKey);return H})},Si=function(){},Nm$=function(){this.X={};
this.X[0]=new Si;if(!g.ZX("aes_pes_encoder_killswitch")){var h=this.X;try{var W=g.vt();var c=Qn6(W);var V=new mp(new g.Hk(c),new g.Bk(c))}catch(H){throw h=H instanceof Error?new vi("KEY_CREATION_FAILED",{originalMessage:H.message}):new vi("KEY_CREATION_FAILED"),g.Qq(h),h;}h[1]=V}},AF2=function(h,W){W=W===void 0?0:W;
h=h.X[W];if(!h)throw W=new vi("INVALID_ENCODER_VERSION",{d4:W}),g.Qq(W),W;return h},gq=function(h,W){g.N.call(this);
this.token=h;this.X=W;this.observers=[];h=new g.k5.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.vt());h.onmessage=this.W.bind(this);this.channel=h},Di=function(h,W,c){var V,H,B,E;
return g.P(function(J){if(J.W==1)return g.F(J,qLI(h.token),2);if(J.W!=3)return V=J.X,g.F(J,g.Lg(V,["EntityStore","EntityAssociationStore"],W,function(u){H=new K3l(u,h.X);return c(H)}),3);
B=J.X;H&&(E=H.G,Object.keys(E).length>0&&(h.channel.postMessage(E),XK6(h,E)));return J.return(B)})},wq=function(h,W,c){return Di(h,{mode:"readwrite",
nJ:!0},function(V){return Yi(V,W,c)})},taf=function(h,W){return Di(h,{mode:"readwrite",
nJ:!0},function(c){return MaI(c,W,"offlineOrchestrationActionWrapperEntity")})},vvS=function(h,W){return Di(h,{mode:"readwrite",
nJ:!0},function(c){return O3(c,W)})},mdI=function(h){return Di(h,{mode:"readwrite",
nJ:!0},function(W){return PZ6(W,"videoPlaybackPositionEntity")})},ki=function(h,W,c){return Di(h,{mode:"readonly",
nJ:!0},function(V){return oh(V,W,c)})},hf=function(h,W,c){return Di(h,{mode:"readonly",
nJ:!0},function(V){return ph(V,W,c)})},XK6=function(h,W){h=g.e(h.observers);
for(var c=h.next();!c.done;c=h.next())c=c.value,c(W)},ov$=function(){var h,W,c;
return g.P(function(V){if(V.W==1)return g.Qp(V,2),g.F(V,g.IC(),4);if(V.W!=2){h=V.X;if(!h||!g.m1()||typeof g.k5.BroadcastChannel==="undefined")return V.return();W=new Nm$;return V.return(new gq(h,W))}c=g.CU(V);c instanceof Error&&g.Qq(c);return V.return()})},WZ=function(){pKX||(pKX=ov$());
return pKX},I96=function(h){var W;
h=(W=h.options)==null?void 0:W.persistenceOption;return h==="ENTITY_PERSISTENCE_OPTION_PERSIST"||h==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},YLU=function(h){var W;
return g.P(function(c){return c.W==1?g.F(c,WZ(),2):(W=c.X)?g.F(c,Di(W,"readwrite",function(V){for(var H={},B=g.e(h),E=B.next(),J={};!E.done;J={jt:void 0,gL:void 0},E=B.next())J.jt=E.value,J.jt.entityKey&&I96(J.jt)&&(J.gL=g.VW(J.jt.payload),E=void 0,J.jt.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(E=function(u){return function(){return Yi(V,u.jt.payload[u.gL],u.gL)}}(J)),J.jt.type==="ENTITY_MUTATION_TYPE_DELETE"&&(E=function(u){return function(){return O3(V,u.jt.entityKey)}}(J)),J.jt.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(E=function(u){return function(){return f9S(V,u.jt.entityKey,u.jt.payload[u.gL],u.gL)}}(J)),E&&(H[J.jt.entityKey]=H[J.jt.entityKey]?H[J.jt.entityKey].then(E):E()));
return g.x4.all(Object.values(H))}),0):c.return()})},OW$=function(h){var W;
return g.P(function(c){if(c.W==1){W=h.mutations;if(!W||W.length<=0)return c.return();if(g.ey){var V={type:"ENTITY_LOADED"};W!==void 0&&(V.payload=W);g.ey.dispatch(V)}return g.F(c,YLU(W),2)}W.length=0;g.zQ(c)})},SLU=function(h){return h!==void 0},gvI=function(h){var W=g.wu();
W=Object.assign({},W);h=Object.assign({},h);for(var c in W)h[c]?(W[c]!==4&&(W[c]=h[c]),delete h[c]):W[c]!==2&&(W[c]=4);Object.assign(W,h);g.mZQ(W);JSON.stringify(W);return W},DdU=function(h){var W,c;
return g.P(function(V){if(V.W==1)return g.F(V,g.IC(),2);if(V.W!=3)return(W=V.X)?g.F(V,g.WT(W),3):V.return();c=V.X;return V.return(g.Lg(c,["index","media","captions"],{mode:"readwrite",nJ:!0},function(H){var B=IDBKeyRange.bound(h+"|",h+"~");H=[H.objectStore("index").delete(B),H.objectStore("media").delete(B),H.objectStore("captions").delete(B)];return g.x4.all(H).then(function(){})}))})},wKU=function(){var h,W;
return g.P(function(c){if(c.W==1)return g.F(c,g.IC(),2);if(c.W!=3){h=c.X;if(!h)throw g.rw("rvdfd");return g.F(c,g.WT(h),3)}W=c.X;return c.return(g.Lg(W,["index","media"],{mode:"readwrite",nJ:!0},function(V){var H={};return g.Cg(V.objectStore("index"),{},function(B){var E=B.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),J=g.x4.resolve(void 0);if(E){var u=E[1];E=E[2];H[u]=H[u]||{};var d;H[u][E]=g.OaU((d=B.getValue())==null?void 0:d.fmts)}else J=B.delete().then(function(){});
return g.x4.all([g.Mv(B),J]).then(function(G){return g.e(G).next().value})}).then(function(){for(var B={},E=g.e(Object.keys(H)),J=E.next();!J.done;J=E.next()){J=J.value;
var u=H[J].v;B[J]=H[J].a&&u?1:2}var d=gvI(B);return g.MEv(V.objectStore("media"),{},function(G){var Z=G.cursor.key.match(g.wsN);Z&&B[Z[1]]||V.objectStore("media").delete(G.cursor.key);return g.e5k(G)}).then(function(){return d})})}))})},ksu=function(h,W){var c,V;
return g.P(function(H){if(H.W==1)return g.F(H,g.IC(),2);if(H.W!=3){c=H.X;if(!c)throw g.rw("wct");return g.F(H,g.WT(c),3)}V=H.X;return g.F(H,g.Lg(V,["captions"],{mode:"readwrite",nJ:!0},function(B){var E=[];B=B.objectStore("captions");for(var J=0;J<W.length;J++){var u=g.iC(B,W[J],h+"|"+W[J].metadata.vss_id);E.push(u)}return g.x4.all(E)}),0)})},huI=function(h){var W,c,V;
return g.P(function(H){if(H.W==1)return W=IDBKeyRange.bound(h+"|",h+"~"),g.F(H,g.IC(),2);if(H.W!=3){c=H.X;if(!c)throw g.rw("gactfv");return g.F(H,g.WT(c),3)}V=H.X;return H.return(V.getAll("captions",W))})},WVX=function(h){return g.P(function(W){g.hT(h,0);
return W.return(DdU(h))})},cEX=function(h){return{context:g.pV(),
videoIds:h}},Vc2=function(h){return{context:g.pV(),
playlistIds:h}},$Vc=function(h){return{context:g.pV(),
offlinePlaylistSyncChecks:h}},s_6=function(){this.X=new Map},Bl2=function(){Hel||(Hel=new s_6);
return Hel},EQc=function(h,W){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:h},metadata:W,statusCode:void 0,csn:void 0,can:void 0}},Ru$=function(h,W,c){if(!c){var V=V===void 0?!1:V;
c=h.X.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!c||V)c=g.Ge(16),h.X.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",c)}h={flowNonce:c,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:W.eventType};W.metadata&&(h.flowMetadata=W.metadata);W.statusCode!==void 0&&(h.flowEventStatus=W.statusCode);W.csn&&(h.csn=W.csn);W.can&&(h.can=W.can);g.V5("flowEvent",h,void 0)},JEt=function(h){var W,c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf,Fl,BG,Tt,p$,EO,C,tB;
return g.P(function(yU){if(yU.W==1)return g.F(yU,Di(h,{mode:"readonly",nJ:!0},function(Vp){return ph(Vp,"playbackData").then(function(iK){var Q=iK.map(function(v2){return v2.transfer}).filter(function(v2){return!!v2}),cd=iK.map(function(v2){return v2.offlineVideoPolicy}).filter(function(v2){return!!v2}),Fa=iK.filter(function(v2){return!!v2.key}).map(function(v2){return g.Ib(g.pP(v2.key).entityId,"downloadStatusEntity")});
Q=ph(Vp,"transfer",Q);cd=ph(Vp,"offlineVideoPolicy",cd);Fa=ph(Vp,"downloadStatusEntity",Fa);var R0=Q.then(function(v2){v2=v2.reduce(function(Ov,VU){(VU==null?0:VU.offlineVideoStreams)&&Ov.push.apply(Ov,g.rN(VU.offlineVideoStreams));return Ov},[]).filter(function(Ov){return!!Ov});
return ph(Vp,"offlineVideoStreams",v2)});
return g.x4.all([Q,cd,R0,Fa]).then(function(v2){var Ov=g.e(v2);v2=Ov.next().value;var VU=Ov.next().value;var hk=Ov.next().value;Ov=Ov.next().value;return[iK,v2,VU,hk,Ov]})})}),2);
if(yU.W!=3)return W=yU.X,g.F(yU,Di(h,{mode:"readonly",nJ:!0},function(Vp){return ph(Vp,"mainDownloadsListEntity").then(function(iK){var Q,cd;return(cd=(Q=iK[0])==null?void 0:Q.downloads)!=null?cd:[]})}),3);
c=yU.X;V=g.e(W);H=V.next().value;B=V.next().value;E=V.next().value;J=V.next().value;u=V.next().value;d=H;G=B;Z=E;r=J;q=u;x={};z={};L={};M={};U={};y=[];T=g.e(G);for(m=T.next();!m.done;m=T.next())(D=m.value)&&(x[D.key]=D);O=g.e(Z);for(Bd=O.next();!Bd.done;Bd=O.next())(qL=Bd.value)&&(z[qL.key]=qL);Rk=g.e(q);for(JN=Rk.next();!JN.done;JN=Rk.next())(Wd=JN.value)&&(L[Wd.key]=Wd);Uv=g.e(r);for(gN=Uv.next();!gN.done;gN=Uv.next())(W2=gN.value)&&(M[W2.key]=W2);lK=g.e(c);for(Rf=lK.next();!Rf.done;Rf=lK.next())Fl=
Rf.value,BG=void 0,U[(BG=Fl.videoItem)!=null?BG:""]=!0,Fl.videoItem&&(p$=Tt=void 0,EO=(p$=(Tt=g.pP(Fl.videoItem))==null?void 0:Tt.entityId)!=null?p$:"",y.push({externalVideoId:EO}));C=d.filter(function(Vp){if(!Vp||!Vp.key||!Vp.offlineVideoPolicy)return!1;Vp=g.pP(Vp.key).entityId;Vp=g.Ib(Vp,"downloadStatusEntity");var iK;return!(Vp&&((iK=L[Vp])==null?void 0:iK.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
tB=C.map(function(Vp){var iK=x[Vp.transfer],Q=[];if(iK==null?0:iK.offlineVideoStreams)for(var cd=g.e(iK.offlineVideoStreams),Fa=cd.next();!Fa.done;Fa=cd.next())(Fa=M[Fa.value])&&Q.push(Fa);cd=z[Vp.offlineVideoPolicy];Fa=U;var R0=Vp==null?void 0:Vp.playerResponseTimestamp,v2=g.pP(cd.key).entityId;Vp=g.Ib(v2,"mainVideoEntity");if(cd.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Ov="OFFLINE_VIDEO_STATE_DISABLED";cd.expirationTimestamp&&Number(cd.expirationTimestamp)<Date.now()/1E3&&(Ov="OFFLINE_VIDEO_STATE_EXPIRED")}else if(cd.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Ov="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(iK==null?void 0:iK.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Ov="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Ov="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Ov="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Ov="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Ov="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Ov="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Ov="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Ov==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(iK==null?void 0:iK.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Ov="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Ov="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Ov=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}v2={id:v2,videoState:Ov};if(iK==null?0:iK.cotn)v2.cotn=iK.cotn;if(iK==null?0:iK.maximumDownloadQuality)v2.selectedVideoQuality=iK==null?void 0:iK.maximumDownloadQuality;if(iK==null?0:iK.lastProgressTimeMs)v2.lastProgressTimeMs=iK.lastProgressTimeMs;R0&&(v2.playerResponseSavedTimeMs=String(Number(R0)*1E3));iK=String;R0=0;Q=g.e(Q);for(Ov=Q.next();!Ov.done;Ov=Q.next())if(Ov=Ov.value,Ov.streamsProgress){Ov=g.e(Ov.streamsProgress);for(var VU=Ov.next();!VU.done;VU=Ov.next()){var hk=
void 0;R0+=Number((hk=VU.value.numBytesDownloaded)!=null?hk:0)}}v2.downloadedBytes=iK(R0);v2.selectedOfflineMode=Fa[Vp]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";cd.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(v2.offlinePlaybackDisabledReason=cd.offlinePlaybackDisabledReason);return v2});
return yU.return({offlineVideos:tB,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:y}}})})},uHc=function(){this.locks=navigator.locks},dVU=function(){try{var h=g.c2("ytglobal.locks_");
if(h)return h;var W;if(W=navigator){var c=navigator;W="locks"in c&&!!c.locks}if(W)return g.k5.localStorage&&g.k5.localStorage.getItem("noop"),h=new uHc,g.hS("ytglobal.locks_",h),h}catch(V){}},cZ=function(){},GTU=function(){},ZeI=function(h){if(h.includes(":"))throw Error("Invalid user cache name: "+h);
return h+":"+g.vt("CacheStorage get")},rEU=function(){return g.P(function(h){if(VF!==void 0)return h.return(VF);
VF=new Promise(function(W){var c;return g.P(function(V){switch(V.W){case 1:return g.Qp(V,2),g.F(V,$m.open("test-only"),4);case 4:return g.F(V,$m.delete("test-only"),5);case 5:g.AN(V,3);break;case 2:if(c=g.CU(V),c instanceof Error&&c.name==="SecurityError")return W(!1),V.return();case 3:W("caches"in window),g.zQ(V)}})});
return h.return(VF)})},xVS=function(){return g.P(function(h){if(h.W==1)return g.F(h,rEU(),2);
if(!h.X)return h.return(void 0);qEK||(qEK=new GTU);return h.return(qEK)})},sU=function(h,W,c){g.Lx(new g.tP("Woffle: "+h,c?{cotn:c}:""));
W instanceof Error&&g.Lx(W)},lDK=function(h){var W;
return g.P(function(c){if(c.W==1)return g.F(c,JEt(h),2);W=c.X;g.V5("offlineStateSnapshot",W);g.zQ(c)})},HZ=function(h){g.N.call(this);
var W=this;this.api=h;this.uX={exB:function(){return W.X},
b5M:function(){return W.W}};
typeof g.k5.BroadcastChannel!=="undefined"&&(this.X=new g.k5.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.vt()),this.X.onmessage=this.G.bind(this),this.W=new g.k5.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.vt()),this.W.onmessage=this.Y.bind(this))},BZ=function(h,W){h.api.Iz("onOfflineOperationFailure",W);
var c;(c=h.X)==null||c.postMessage(W)},nQI=function(h,W,c){var V=this;
this.Z=h;this.T=W;this.visibility=c;this.C=this.S=this.N=this.G=this.X=!1;this.Y=new g.oD(function(){V.LK()});
this.uX={uI:function(){return V.W},
LK:function(){V.LK()},
H5B:function(){return V.Y}};
this.visibility.subscribe("visibilitystatechange",function(){V.RV()})},j_l=function(h){if(!h.G&&!h.X){var W=dVU();
if(W){h.G=!0;var c=g.vt("OfflineLockManager");W.request("woffle_orchestration_leader:"+c,{},function(){var V,H;return g.P(function(B){switch(B.W){case 1:return g.Qp(B,2),h.W=new g.R_,h.X=!0,h.G=!1,g.F(B,h.Z(),4);case 4:return g.F(B,h.W.promise,5);case 5:g.AN(B,0);break;case 2:V=g.CU(B),h.LK(),V instanceof Error&&(H=V,H.args=[{name:"WoLockManagerError",Mw:V.name}],g.Qq(H)),g.zQ(B)}})})}}},aDl=function(h){h.X&&(h.C=!0,EU(h))},eu6=function(h,W){h.X&&(h.N=W,EU(h))},zuK=function(h,W){h.X&&(h.S=W,EU(h))},
EU=function(h){h.S&&h.N&&h.C&&h.visibility.isBackground()?g.pO(h.Y,6E4):h.Y.stop()},RF=function(h){var W;
h.offlineDeleteReason=(W=h.offlineDeleteReason)!=null?W:"OFFLINE_DELETE_REASON_UNKNOWN";var c;h.offlineModeType=(c=h.offlineModeType)!=null?c:"OFFLINE_NOW";g.V5("offlineDeleteEvent",h)},Jf=function(h,W){var c=W.videoId;
var V=W.p$;W=W.offlineModeType;h.encryptedVideoId=c;h.cotn=V==null?void 0:V.cotn;h.offlineabilityFormatType=V==null?void 0:V.maximumDownloadQuality;var H;h.isRefresh=(H=V==null?void 0:V.isRefresh)!=null?H:!1;var B;h.softErrorCount=(B=V==null?void 0:V.transferRetryCount)!=null?B:0;h.offlineModeType=W!=null?W:"OFFLINE_NOW";(h.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&h.statusType==="UNKNOWN_STATUS_TYPE"||!h.transferStatusType&&!h.statusType)&&g.Lx(Error("Woffle unknown transfer status"));
g.V5("offlineTransferStatusChanged",h)},Q_2=function(h){Jf({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},h)},LV6=function(h,W,c,V){V={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!V};W&&c&&(W=Math.floor(W/1024).toFixed(),c=Math.floor(c/1024).toFixed(),V.alreadyDownloadedKbytes=W,V.totalFetchedKbytes=W,V.totalContentKbytes=c);Jf(V,h)},ieu=function(h){Jf({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},h)},KVU=function(h){Jf({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},h)},AEu=function(h){switch(h){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
uk=function(h){var W,c,V;
return((V=(W=h.actionMetadata)==null?void 0:(c=W.retryScheduleIntervalsInSeconds)==null?void 0:c.length)!=null?V:0)>0},dB=function(h){return h.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!h.entityKey},Gg=function(h){return h.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!h.entityKey},Zm=function(h){return h.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!h.entityKey},UVf=function(h){return h.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!h.entityKey},
rB=function(h,W,c,V,H){H=H===void 0?!1:H;
var B,E,J,u,d,G;return g.P(function(Z){if(Z.W==1)return B=g.Ib(h,W),E=g.Ib(h,"downloadStatusEntity"),g.F(Z,Di(c,{mode:"readonly",nJ:!0},function(r){return g.x4.all([oh(r,B,W),oh(r,E,"downloadStatusEntity")])}),2);
J=Z.X;u=J.length?J[0]:void 0;if(!u)return Z.bB(0);d=CdU;if(G=J.length>1?J[1]:void 0){if(G.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!H)return Z.return();G.downloadState=V}else G={key:E,downloadState:V};g.Cx(u,d,G);return g.F(Z,Di(c,{mode:"readwrite",nJ:!0},function(r){return g.x4.all([Yi(r,u,W),Yi(r,G,"downloadStatusEntity")])}),0)})},qR=function(h,W){return h.actionType===W.actionType&&h.entityKey===W.entityKey},xm=function(h,W){if(h&&h.transferState!=="TRANSFER_STATE_COMPLETE"&&h.transferState!==
"TRANSFER_STATE_FAILED"){var c=g.pP(h.key).entityId;
Jf({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:c,p$:h,offlineModeType:W})}},lk=function(h){if(!h||!h.thumbnails)return[];
var W=[];h=g.e(h.thumbnails);for(var c=h.next();!c.done;c=h.next())c=c.value,c.url&&W.push(c.url);return W},Mcf=function(h,W,c){c=c===void 0?[]:c;
var V,H,B,E,J,u,d,G,Z,r,q,x,z;return g.P(function(L){if(L.W==1)return c.length?g.F(L,hf(h,W),2):L.return([]);V=L.X;H=new Set;B=g.e(V);for(E=B.next();!E.done;E=B.next())if(J=E.value,u=J.id||J.key)d=g.pP(u).entityId,H.add(d);G=[];Z=g.e(c);for(r=Z.next();!r.done;r=Z.next())q=r.value,x=q.offlineVideoData,z=void 0,((z=x)==null?0:z.videoId)&&!H.has(x.videoId)&&G.push(q);return L.return(G)})},FVl=function(h,W,c){return new g.G8(h,{cotn:W,
raw_player_response:c,download_media:!0,start:Infinity,disable_watch_next:!0})},yE6=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},nd=function(h,W,c,V,H,B,E,J,u,d,G){this.entityType=h;
this.actionId=W;this.action=c;this.parentActionId=V;this.rootActionId=H===void 0?W:H;this.childActionIds=B;this.prereqActionId=E;this.postreqActionIds=J;this.hasChildActionFailed=d;this.retryScheduleIndex=0;this.X=G||Date.now();this.retryScheduleIndex=u||0},jh=function(h){if(!h.key)throw Error("Entity key is required.");
if(!h.actionProto)throw Error("OfflineOrchestrationAction is required.");var W=g.pP(h.key),c=g.pP(h.actionProto.entityKey);return new nd(c.entityType,W.entityId,h.actionProto,h.parentActionId,h.rootActionId,h.childActionIds,h.prereqActionId,h.postreqActionIds,h.retryScheduleIndex,h.hasChildActionFailed,Number(h.enqueueTimeSec)*1E3)},aF=function(h){return{key:g.Ib(h.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:h.action,parentActionId:h.parentActionId,rootActionId:h.rootActionId,childActionIds:h.childActionIds,prereqActionId:h.prereqActionId,postreqActionIds:h.postreqActionIds,retryScheduleIndex:h.retryScheduleIndex,hasChildActionFailed:h.hasChildActionFailed,enqueueTimeSec:(h.X/1E3).toFixed()}},Pd2=function(){var h;
return g.P(function(W){return W.W==1?g.F(W,xVS(),2):(h=W.X)?W.return(h.delete("yt-player-local-img")):W.return(!0)})},eh=function(h){var W,c;
return g.P(function(V){if(V.W==1)return g.F(V,xVS(),2);if(V.W!=3){W=V.X;if(!W)throw Error("Cache API not supported");return h.length?g.F(V,W.open("yt-player-local-img"),3):V.return()}c=V.X;return g.F(V,Promise.all(h.map(function(H){return c.delete(H)})),0)})},zg=function(h){var W,c;
return g.P(function(V){if(V.W==1)return g.F(V,xVS(),2);if(V.W!=3){W=V.X;if(!W)throw Error("Cache API not supported");return h.length?g.F(V,W.open("yt-player-local-img"),3):V.return()}c=V.X;return g.F(V,c.addAll(h),0)})},QF=function(h,W,c,V,H){var B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf,Fl,BG;
return g.P(function(Tt){switch(Tt.W){case 1:return B=g.Ib(h,"mainVideoEntity"),E=g.Ib(h,"ytMainChannelEntity"),J=g.Ib(h,"transfer"),u=g.Ib(h,"videoDownloadContextEntity"),g.F(Tt,Di(W,{mode:"readonly",nJ:!0},function(p$){return g.x4.all([oh(p$,B,"mainVideoEntity"),oh(p$,E,"ytMainChannelEntity"),oh(p$,J,"transfer"),oh(p$,u,"videoDownloadContextEntity"),ph(p$,"ytMainChannelEntity"),ph(p$,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=Tt.X;G=g.e(d);Z=G.next().value;r=G.next().value;q=G.next().value;x=G.next().value;z=G.next().value;L=G.next().value;M=Z;U=r;y=q;T=x;m=z;D=L;if(!M&&!U){Tt.bB(3);break}O=M?lk(M.thumbnail):[];if(!U){Bd=[];Tt.bB(4);break}return g.F(Tt,fDI(U,m),5);case 5:Bd=Tt.X;case 4:return qL=Bd,g.F(Tt,eh(O.concat(qL)),3);case 3:Rk=[];JN=g.Ib(h,"downloadStatusEntity");Wd=g.e(D);for(Uv=Wd.next();!Uv.done;Uv=Wd.next())gN=Uv.value,W2=g.pP(gN.key).entityId,lK=jh(gN),Rf=g.pP(lK.action.entityKey).entityId,W2!==h&&
Rf!==h||qR(c,gN.actionProto)||Rk.push(gN.key);return g.F(Tt,Di(W,{mode:"readwrite",nJ:!0},function(p$){var EO=Rk.map(function(C){return O3(p$,C)});
EO.push(O3(p$,B,{ow:!0}));EO.push(O3(p$,JN,{ow:!0}));return g.x4.all(EO)}),7);
case 7:BG=(Fl=T)==null?void 0:Fl.offlineModeType,H&&(RF(H),H.offlineModeType&&(BG=H.offlineModeType)),xm(y,BG),BZ(V,{entityKey:B,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.zQ(Tt)}})},Nl6=function(h,W,c,V){var H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf,Fl,BG,Tt,p$,EO,C,tB,yU,Vp,iK,Q,cd,Fa,R0,v2,Ov,VU,hk,vG,K;
return g.P(function(a){switch(a.W){case 1:return H=g.Ib(h,"mainPlaylistEntity"),B=g.Ib(h,"ytMainChannelEntity"),g.F(a,Di(W,{mode:"readonly",nJ:!0},function(A){return g.x4.all([oh(A,H,"mainPlaylistEntity"),oh(A,B,"ytMainChannelEntity"),ph(A,"mainPlaylistEntity"),ph(A,"mainDownloadsListEntity"),ph(A,"ytMainChannelEntity"),ph(A,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=a.X;J=g.e(E);u=J.next().value;d=J.next().value;G=J.next().value;Z=J.next().value;r=J.next().value;q=J.next().value;x=u;z=d;L=G;M=Z;U=r;y=q;if(!x&&!z){a.bB(3);break}T=x?beX(x):[];if(!z){m=[];a.bB(4);break}return g.F(a,fDI(z,U),5);case 5:m=a.X;case 4:return D=m,g.F(a,eh(T.concat(D)),3);case 3:O=[];Bd=new Map;if(!x){a.bB(7);break}return g.F(a,TlS(x,L,M),8);case 8:O=a.X;qL=g.e(O);for(Rk=qL.next();!Rk.done;Rk=qL.next())JN=Rk.value,Bd.set(JN,{videoId:JN,playlistId:h,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.F(a,Di(W,{mode:"readonly",nJ:!0},function(A){return g.x4.all([ph(A,"transfer"),ph(A,"videoDownloadContextEntity")])}),9);
case 9:Wd=a.X;Uv=g.e(Wd);gN=Uv.next().value;W2=Uv.next().value;lK=gN;Rf=W2;Fl=g.e(lK);for(BG=Fl.next();!BG.done;BG=Fl.next())Tt=BG.value,p$=g.pP(Tt.key).entityId,(EO=Bd.get(p$))&&Tt&&(EO.cotn=Tt.cotn);C=g.e(Rf);for(tB=C.next();!tB.done;tB=C.next())yU=tB.value,Vp=g.pP(yU.key).entityId,(iK=Bd.get(Vp))&&yU&&(iK.offlineModeType=yU.offlineModeType);case 7:Q=[];cd=g.e(y);for(Fa=cd.next();!Fa.done;Fa=cd.next())R0=Fa.value,v2=g.pP(R0.key).entityId,Ov=jh(R0),v2!==h&&Ov.rootActionId!==h||qR(c,R0.actionProto)||
Q.push(R0.key);VU=g.Ib(h,"mainPlaylistEntity");return g.F(a,Di(W,{mode:"readwrite",nJ:!0},function(A){var f=Q.map(function(t){return O3(A,t)});
f.push(O3(A,VU,{ow:!0}));return g.x4.all(f)}),10);
case 10:if(!x){a.bB(0);break}O.reverse();if(!O){a.bB(0);break}hk=g.e(O);vG=hk.next();case 13:if(vG.done){a.bB(0);break}K=vG.value;return g.F(a,QF(K,W,c,V,Bd.get(K)),14);case 14:vG=hk.next(),a.bB(13)}})},tcS=function(h,W,c,V){var H,B,E,J,u,d,G,Z,r;
return g.P(function(q){if(q.W==1)return H=g.Ib("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),B=new Map,g.F(q,Di(h,{mode:"readwrite",nJ:!0},function(x){var z=ph(x,"transfer"),L=ph(x,"offlineOrchestrationActionWrapperEntity"),M=ph(x,"videoDownloadContextEntity"),U=oh(x,H,"mainDownloadsListEntity");return g.x4.all([z,L,M,U]).then(function(y){y=g.e(y);var T=y.next().value;var m=y.next().value;var D=y.next().value;var O=y.next().value;y=X9l.map(function(qL){return PZ6(x,qL)});
m=g.e(m);for(var Bd=m.next();!Bd.done;Bd=m.next())Bd=Bd.value,qR(W,Bd.actionProto)||y.push(O3(x,Bd.key,{ow:!0}));O&&(O.downloads=[],y.push(Yi(x,O,"mainDownloadsListEntity")));if(D)for(D=g.e(D),O=D.next();!O.done;O=D.next())O=O.value,m=g.pP(O.key).entityId,m=g.Ib(m,"transfer"),B.set(m,O.offlineModeType);return g.x4.all(y).then(function(){return T})})}),2);
E=q.X;J=g.e(E);for(u=J.next();!u.done;u=J.next())d=u.value,xm(d,B.get(d.key)),G=g.pP(d.key).entityId,Z={videoId:G,offlineDeleteReason:V,cotn:d.cotn,offlineModeType:B.get(d.key)},RF(Z),r=g.Ib(G,"mainVideoEntity"),BZ(c,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.F(q,Pd2(),0)})},beX=function(h,W){var c=[];
if(h.thumbnailStyleData){h=g.e(h.thumbnailStyleData);for(var V=h.next();!V.done;V=h.next()){var H=void 0,B=void 0,E=void 0;c=c.concat(lk((H=V.value)==null?void 0:(B=H.value)==null?void 0:(E=B.collageThumbnail)==null?void 0:E.coverThumbnail))}}W=lk(W);return c.concat(W)},TlS=function(h,W,c){var V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL;
return g.P(function(Rk){V=[];H=new Set;if(c.length)for(B=g.e(c),E=B.next();!E.done;E=B.next())if(J=E.value,u=void 0,(u=J.downloads)==null?0:u.length)for(d=g.e(J.downloads),G=d.next();!G.done;G=d.next())Z=G.value,Z.videoItem&&(r=g.pP(Z.videoItem).entityId,H.add(r));if(h.videos){q=g.e(h.videos);for(x=q.next();!x.done;x=q.next())z=x.value,L=JSON.parse(g.pP(z).entityId),L.videoId&&!H.has(L.videoId)&&V.push(L.videoId);M=g.e(W);for(U=M.next();!U.done;U=M.next())if(y=U.value,y.key!==h.key&&(T=y.videos))for(m=
g.e(T),D=m.next();!D.done;D=m.next())O=D.value,Bd=JSON.parse(g.pP(O).entityId),Bd.videoId&&(qL=V.indexOf(Bd.videoId),qL!==-1&&V.splice(qL,1))}return Rk.return(V)})},fDI=function(h,W){var c,V,H,B,E,J,u,d;
return g.P(function(G){c=lk(h.avatar);V=g.e(W);for(H=V.next();!H.done;H=V.next())if(B=H.value,B.id!==h.id)for(E=g.e(lk(B.avatar)),J=E.next();!J.done;J=E.next())u=J.value,d=c.indexOf(u),d!==-1&&c.splice(d,1);return G.return(c)})},vQf=function(h){var W;
return g.P(function(c){W=g.v(h.frameworkUpdates,Ld);return h.frameworkUpdates&&W?g.F(c,OW$(W),0):c.return()})},oQ6=function(h){var W;
if((W=h.onResponseReceivedActions)!=null&&W.length){var c;h=(c=g.v(g.v(h.onResponseReceivedActions[0],mVU),g.SuK))==null?void 0:c.actions;if(h!=null&&h.length)return h}},p9K=function(h){var W,c,V;
return g.P(function(H){if(H.W==1)return h?g.F(H,ki(h,g.vC,"mainDownloadsListEntity"),2):H.return([]);W=H.X;return((c=W)==null?0:(V=c.downloads)==null?0:V.length)?H.return(W.downloads.map(function(B){var E;return(E=B.videoItem)!=null?E:""})):H.return([])})},YEU=function(h,W){var c;
return g.P(function(V){return V.W==1?g.F(V,ID6(h,W),2):(c=V.X)?g.F(V,Di(h,{mode:"readwrite",nJ:!0},function(H){var B=[Yi(H,c.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];c.mainDownloadsListEntity&&B.push(Yi(H,c.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.x4.all(B)}),0):V.bB(0)})},ID6=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y;
return g.P(function(T){if(T.W==1)return c=g.Ib("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.Ib("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.F(T,Di(h,{mode:"readonly",nJ:!0},function(m){return g.x4.all([oh(m,c,"mainDownloadsLibraryEntity"),oh(m,V,"mainDownloadsListEntity")])}),2);
H=T.X;B=g.e(H);E=B.next().value;J=B.next().value;u=E;d=J;u||(u={id:c});G=g.e(W);for(Z=G.next();!Z.done;Z=G.next())if(r=Z.value,r===g.vC){if(u.smartDownloadsList)return T.return();u.smartDownloadsList=r}else if(q=g.pP(r).entityType,x={},q==="mainPlaylistEntity"?x.playlistItem=r:q==="mainVideoEntity"&&(x.videoItem=r),!g.GF(x)){z=void 0;if((z=d)==null?0:z.downloads){L=!1;M=g.e(d.downloads);for(U=M.next();!U.done;U=M.next())if(y=U.value,y.playlistItem===r||y.videoItem===r){L=!0;break}L||d.downloads.push(x)}else d=
{id:V,downloads:[x]};u.downloadsList=V}return T.return({mainDownloadsLibraryEntity:u,mainDownloadsListEntity:d})})},Oeu=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L;
return g.P(function(M){if(M.W==1)return c=g.Ib("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.Ib("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.F(M,Di(h,{mode:"readonly",nJ:!0},function(U){return g.x4.all([oh(U,c,"mainDownloadsLibraryEntity"),oh(U,V,"mainDownloadsListEntity"),oh(U,g.vC,"mainDownloadsListEntity")])}),2);
H=M.X;B=g.e(H);E=B.next().value;J=B.next().value;u=B.next().value;d=E;G=J;Z=u;if(!d)return M.bB(0);if(W===g.vC&&((r=Z)==null?0:r.downloads))Z.downloads=[];else if((q=G)==null?0:q.downloads)for(x=g.pP(W).entityType,z=0;z<G.downloads.length;z++)if(L=G.downloads[z],x==="mainVideoEntity"&&L.videoItem===W){G.downloads.splice(z,1);break}else if(x==="mainPlaylistEntity"&&L.playlistItem===W){G.downloads.splice(z,1);break}return g.F(M,Di(h,{mode:"readwrite",nJ:!0},function(U){var y=[Yi(U,d,"mainDownloadsLibraryEntity")];
G&&y.push(Yi(U,G,"mainDownloadsListEntity"));Z&&y.push(Yi(U,Z,"mainDownloadsListEntity"));return g.x4.all(y)}),0)})},ik=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r;
return g.P(function(q){if(q.W==1)return c=g.Ib(W,"transfer"),V=g.Ib(W,"videoDownloadContextEntity"),g.F(q,Di(h,{mode:"readonly",nJ:!0},function(x){return g.x4.all([oh(x,c,"transfer"),oh(x,V,"videoDownloadContextEntity")])}),2);
H=q.X;B=g.e(H);E=B.next().value;J=B.next().value;u=E;d=J;r={videoId:W,cotn:(G=u)==null?void 0:G.cotn,offlineModeType:(Z=d)==null?void 0:Z.offlineModeType};return q.return(r)})},Kd=function(h,W,c,V,H){var B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd;
return g.P(function(qL){switch(qL.W){case 1:return B=g.Ib(h,"musicTrack"),E=g.Ib(h,"transfer"),g.F(qL,Di(W,{mode:"readonly",nJ:!0},function(Rk){return g.x4.all([oh(Rk,B,"musicTrack"),oh(Rk,E,"transfer"),ph(Rk,"musicTrack"),ph(Rk,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:J=qL.X;u=g.e(J);d=u.next().value;G=u.next().value;Z=u.next().value;r=u.next().value;q=d;x=G;z=Z;L=r;if(!q){qL.bB(3);break}return g.F(qL,SEI(q,z),4);case 4:return M=qL.X,g.F(qL,eh(M),3);case 3:U=[];y=g.e(L);for(T=y.next();!T.done;T=y.next())m=T.value,D=g.pP(m.key).entityId,O=jh(m),Bd=g.pP(O.action.entityKey).entityId,D!==h&&Bd!==h||qR(c,m.actionProto)||U.push(m.key);return g.F(qL,Di(W,{mode:"readwrite",nJ:!0},function(Rk){var JN=U.map(function(Wd){return O3(Rk,Wd)});
JN.push(O3(Rk,B,{ow:!0}));return g.x4.all(JN)}),6);
case 6:xm(x),H&&RF(H),BZ(V,{entityKey:B,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.zQ(qL)}})},Af=function(h,W,c,V,H){var B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf,Fl,BG,Tt,p$,EO,C,tB;
return g.P(function(yU){switch(yU.W){case 1:return B=g.Ib(h,W),E=g.Ib("music_downloads_library_id","musicDownloadsLibraryEntity"),g.F(yU,Di(c,{mode:"readonly",nJ:!0},function(Vp){return g.x4.all([oh(Vp,B,W),oh(Vp,E,"musicDownloadsLibraryEntity"),ph(Vp,W),ph(Vp,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:J=yU.X;u=g.e(J);d=u.next().value;G=u.next().value;Z=u.next().value;r=u.next().value;q=d;x=G;z=Z;L=r;if(!q){yU.bB(3);break}return g.F(yU,SEI(q,z),4);case 4:return M=yU.X,g.F(yU,eh(M),3);case 3:U=[];y=new Map;if(!q){yU.bB(6);break}return g.F(yU,gQI(q,z,x),7);case 7:U=yU.X;T=g.e(U);for(m=T.next();!m.done;m=T.next())D=m.value,O=g.pP(D).entityId,y.set(O,{videoId:O,playlistId:h,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.F(yU,hf(c,"transfer"),8);case 8:for(Bd=yU.X,qL=
g.e(Bd),Rk=qL.next();!Rk.done;Rk=qL.next())JN=Rk.value,Wd=g.pP(JN.key).entityId,(Uv=y.get(Wd))&&JN&&(Uv.cotn=JN.cotn);case 6:gN=[];W2=g.e(L);for(lK=W2.next();!lK.done;lK=W2.next())Rf=lK.value,Fl=g.pP(Rf.key).entityId,BG=jh(Rf),Fl!==h&&BG.rootActionId!==h||qR(V,Rf.actionProto)||gN.push(Rf.key);Tt=g.Ib(h,W);return g.F(yU,Di(c,{mode:"readwrite",nJ:!0},function(Vp){var iK=gN.map(function(Q){return O3(Vp,Q)});
iK.push(O3(Vp,Tt,{ow:!0}));return g.x4.all(iK)}),9);
case 9:if(!q){yU.bB(0);break}U.reverse();if(!U.length){yU.bB(0);break}p$=g.e(U);EO=p$.next();case 12:if(EO.done){yU.bB(0);break}C=EO.value;tB=g.pP(C).entityId;if(!tB){yU.bB(13);break}return g.F(yU,Kd(tB,c,V,H,y.get(tB)),13);case 13:EO=p$.next(),yU.bB(12)}})},UU=function(h,W,c){var V,H,B,E,J,u,d;
return g.P(function(G){if(G.W==1)return g.F(G,Di(h,{mode:"readwrite",nJ:!0},function(Z){var r=ph(Z,"transfer"),q=ph(Z,"offlineOrchestrationActionWrapperEntity");return g.x4.all([r,q]).then(function(x){x=g.e(x);var z=x.next().value;var L=x.next().value;x=DVu.map(function(T){return PZ6(Z,T)});
L=g.e(L);for(var M=L.next();!M.done;M=L.next()){M=M.value;var U=g.pP(M.actionProto.entityKey).entityType==="musicTrack",y=M.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";qR(W,M.actionProto)||U&&(!U||y)||x.push(O3(Z,M.key,{ow:!0}))}return g.x4.all(x).then(function(){return z})})}),2);
V=G.X;H=g.e(V);for(B=H.next();!B.done;B=H.next())E=B.value,xm(E),J=g.pP(E.key).entityId,u={videoId:J,offlineDeleteReason:void 0,cotn:E.cotn},RF(u),d=g.Ib(J,"musicTrack"),BZ(c,{entityKey:d,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.F(G,Pd2(),0)})},w9U=function(h){for(var W,c=g.e(h.additionalMetadatas),V=c.next();!V.done;V=c.next())V=V.value,V.offlineMusicVideoData&&(W=V.offlineMusicVideoData);
var H,B,E,J,u;return{id:g.Ib(h.videoId,"musicTrack"),videoId:h.videoId,title:h.title,thumbnailDetails:h.thumbnail,lengthMs:String(Number(h.lengthSeconds)*1E3),albumTitle:(H=W)==null?void 0:H.releaseTitle,musicVideoType:(B=W)==null?void 0:B.musicVideoType,contentRating:{explicitType:(E=W)==null?void 0:E.explicitType},artistNames:((J=W)==null?void 0:J.byline)||((u=W)==null?void 0:u.channelName),downloadMetadata:g.Ib(h.videoId,"musicTrackDownloadMetadataEntity")}},gQI=function(h,W,c){var V,H,B,E,J,u,
d,G,Z,r,q,x,z,L,M,U,y,T;
return g.P(function(m){V=[];H=new Set;if((B=c)==null?0:(E=B.downloadedTracks)==null?0:E.length)for(J=g.e(c.downloadedTracks),u=J.next();!u.done;u=J.next())d=u.value,H.add(d);if(h.tracks){G=g.e(h.tracks);for(Z=G.next();!Z.done;Z=G.next())r=Z.value,H.has(r)||V.push(r);q=g.e(W);for(x=q.next();!x.done;x=q.next())if(z=x.value,z.id!==h.id&&(L=z.tracks))for(M=g.e(L),U=M.next();!U.done;U=M.next())y=U.value,T=V.indexOf(y),T!==-1&&V.splice(T,1)}return m.return(V)})},SEI=function(h,W){var c,V,H,B,E,J,u,d;
return g.P(function(G){c=lk(h.thumbnailDetails);V=g.e(W);for(H=V.next();!H.done;H=V.next())if(B=H.value,B.id!==h.id)for(E=g.e(lk(B.thumbnailDetails)),J=E.next();!J.done;J=E.next())u=J.value,d=c.indexOf(u),d!==-1&&c.splice(d,1);return G.return(c)})},kTt=function(h,W){var c,V,H,B,E,J,u,d,G;
return g.P(function(Z){if(Z.W==1)return c=g.Ib("music_downloads_library_id","musicDownloadsLibraryEntity"),g.F(Z,ki(h,c,"musicDownloadsLibraryEntity"),2);(V=Z.X)||(V={id:c});H=g.pP(W).entityType;H==="musicTrack"?(B=V.downloadedTracks)!=null&&B.includes(W)||(V.downloadedTracks=((E=V.downloadedTracks)!=null?E:[]).concat(W)):H==="musicPlaylist"?(J=V.downloadedPlaylists)!=null&&J.includes(W)||(V.downloadedPlaylists=((u=V.downloadedPlaylists)!=null?u:[]).concat(W)):H!=="musicAlbumRelease"||(d=V.downloadedAlbumReleases)!=
null&&d.includes(W)||(V.downloadedAlbumReleases=((G=V.downloadedAlbumReleases)!=null?G:[]).concat(W));return g.F(Z,wq(h,V,"musicDownloadsLibraryEntity"),0)})},h5U=function(h,W){var c,V,H,B,E,J,u;
return g.P(function(d){if(d.W==1)return c=g.Ib("music_downloads_library_id","musicDownloadsLibraryEntity"),g.F(d,ki(h,c,"musicDownloadsLibraryEntity"),2);V=d.X;if(!V)return d.bB(0);H=g.pP(W).entityType;H==="musicTrack"?B=V.downloadedTracks:H==="musicPlaylist"&&(B=V.downloadedPlaylists);if((E=B)==null?0:E.length)for(J=0;J<B.length;J++)if(u=B[J],u===W){B.splice(J,1);break}return g.F(d,wq(h,V,"musicDownloadsLibraryEntity"),0)})},WsU=function(h){var W=h.videos;
h=[];var c=[];if(W){W=g.e(W);for(var V=W.next();!V.done;V=W.next()){var H=V.value.offlineVideoData.videoId;V=g.Ib(H,"musicTrack");H=g.Ib(H,"musicTrackDownloadMetadataEntity");h.push(V);c.push(H)}}return{DK:h,zm:c}},Cd=function(h,W,c){W={track:w9U(W)};
c&&(W.playlistId=c);if(h=g.v(h.actionMetadata,cjK))W.maximumDownloadQuality=h.maximumDownloadQuality;return{musicTrackEntityActionMetadata:W}},$fS=function(h){var W,c,V,H,B,E,J,u;
return g.P(function(d){switch(d.W){case 1:return W=g.v5(),c=cEX(h),V=g.OA(VE6),g.Qp(d,2),B={h7:!0},g.F(d,g.CE(W,c,V,void 0,B),4);case 4:H=d.X;g.AN(d,3);break;case 2:E=g.CU(d);if(E instanceof g.NE)throw J="GetOffline network manager error: "+E.message,sU(J,E),Error(J);sU("GetOffline fetch request error",E);throw Error("GetOffline fetch request error");case 3:u=MR(H);if(!H)throw sU("Network request failed"),Error("Network request failed");if(u!==void 0)Ff(u);else if(!H.videos||!H.videos.length)throw sU("No data"),
Error("No data");return d.return(H.videos.map(function(G){return G.offlineVideoData}))}})},sDS=function(h){var W,c,V,H,B,E,J,u;
return g.P(function(d){switch(d.W){case 1:return W=g.v5(),c=Vc2(h),V=g.OA(VE6),g.Qp(d,2),B={h7:!0},g.F(d,g.CE(W,c,V,void 0,B),4);case 4:H=d.X;g.AN(d,3);break;case 2:E=g.CU(d);if(E instanceof g.NE)throw J="GetOffline network manager error for playlist: "+E.message,sU(J,E),Error(J);sU("GetOffline fetch request error for playlist",E);throw Error("GetOffline fetch request error for playlist");case 3:u=MR(H);if(!H)throw sU("Network request failed for playlist"),Error("Network request failed for playlist");
if(u!==void 0)Ff(u,"playlist");else if(!H.playlists||!H.playlists.length)throw sU("No data for playlist"),Error("No data for playlist");return d.return(H.playlists.map(function(G){return G.offlinePlaylistData}))}})},BH6=function(h,W,c,V){var H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf;
return g.P(function(Fl){switch(Fl.W){case 1:return g.F(Fl,WZ(),2);case 2:H=Fl.X;if(!H)return Fl.return([]);B=[];if((E=V)==null?0:E.length){B=V;Fl.bB(3);break}return g.F(Fl,hf(H,"mainPlaylistEntity"),4);case 4:B=Fl.X;case 3:if(!B.length)return Fl.return([]);J=[];u=Date.now()/1E3;d=g.e(B);G=d.next();case 5:if(G.done)return J.length?g.F(Fl,HOX(J),10):Fl.return([]);Z=G.value;if(!Z.downloadState){r=void 0;Fl.bB(8);break}return g.F(Fl,ki(H,Z.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:r=
Fl.X;case 8:q=r;x=void 0;L=(z=(x=Z)==null?void 0:x.entityMetadata)&&z.nextAutoRefreshIntervalSeconds?Number(z.nextAutoRefreshIntervalSeconds):NaN;M=Number.isNaN(L)?h:L;y=U=void 0;T=((U=q)==null?0:U.lastSyncedTimestampMillis)?Number((y=q)==null?void 0:y.lastSyncedTimestampMillis)/1E3:0;D=m=void 0;O=((m=q)==null?0:m.addedTimestampMillis)?Number((D=q)==null?void 0:D.addedTimestampMillis)/1E3:0;if(c||!z||T+M<=u){Bd=[];qL=void 0;if((qL=Z.videos)==null?0:qL.length)for(Rk=g.e(Z.videos),JN=Rk.next();!JN.done;JN=
Rk.next())Wd=JN.value,Uv=JSON.parse(g.pP(Wd).entityId),Uv.videoId&&Bd.push(Uv.videoId);gN="0";z&&(W2=void 0,gN=String(Number((W2=z.offlineLastModifiedTimestampSeconds)!=null?W2:0).toFixed()));lK={playlistId:Z.playlistId,videoIds:Bd,offlineLastModifiedTimestamp:gN,autoSync:W,offlineDateAddedTimestamp:String(O.toFixed())};J.push(lK)}G=d.next();Fl.bB(5);break;case 10:return Rf=Fl.X,Fl.return(Rf)}})},E$c=function(){var h,W,c,V,H;
return g.P(function(B){if(B.W==1)return g.F(B,WZ(),2);if(B.W!=3)return(h=B.X)?g.F(B,hf(h,"refresh"),3):B.return(!1);W=B.X;if((c=W[0])==null||!c.refreshTime)return B.return(!1);V=Number(W[0].refreshTime);H=Date.now()/1E3;return B.return(isFinite(V)&&H>=V)})},Jj6=function(h,W){var c,V,H;
return g.P(function(B){switch(B.W){case 1:return g.Qp(B,2),g.F(B,R5U(h,W),4);case 4:return V=B.X,g.F(B,vQf(V),5);case 5:c=oQ6(V);g.AN(B,3);break;case 2:H=g.CU(B),sU("getAndProcessSmartDownloadsResponse request or processing error",H);case 3:return B.return(c)}})},ud2=function(h,W,c,V){var H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf;
return g.P(function(Fl){switch(Fl.W){case 1:return g.F(Fl,WZ(),2);case 2:H=Fl.X;if(!H)return Fl.return([]);B=[];if((E=V)==null?0:E.length){B=V;Fl.bB(3);break}return g.F(Fl,hf(H,"musicPlaylist"),4);case 4:B=Fl.X;case 3:if(!B.length)return Fl.return([]);J=[];u=Date.now()/1E3;d=g.e(B);G=d.next();case 5:if(G.done)return J.length?g.F(Fl,HOX(J),10):Fl.return([]);Z=G.value;r=void 0;x=(q=(r=Z)==null?void 0:r.entityMetadata)&&q.nextAutoRefreshIntervalSeconds?Number(q.nextAutoRefreshIntervalSeconds):NaN;z=
Number.isNaN(x)?h:x;M=L=0;U="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!Z.downloadMetadata){Fl.bB(8);break}return g.F(Fl,ki(H,Z.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:y=Fl.X,m=T=void 0,L=Number((m=(T=y)==null?void 0:T.addedTimestampMillis)!=null?m:"0")/1E3,O=D=void 0,M=Number((O=(D=y)==null?void 0:D.lastModifiedTimestampMillis)!=null?O:"0")/1E3,qL=Bd=void 0,U=(qL=(Bd=y)==null?void 0:Bd.syncState)!=null?qL:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Rk=void 0;if(c||U!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!q||Number((Rk=q.lastSyncedTimestampSeconds)!=null?Rk:0)+z<=u){JN=[];Wd=void 0;if((Wd=Z.tracks)==null?0:Wd.length)for(Uv=g.e(Z.tracks),gN=Uv.next();!gN.done;gN=Uv.next())W2=gN.value,JN.push(g.pP(W2).entityId);lK={playlistId:Z.playlistId,videoIds:JN,offlineLastModifiedTimestamp:String(M.toFixed()),autoSync:W,offlineDateAddedTimestamp:String(L.toFixed())};J.push(lK)}G=d.next();Fl.bB(5);break;case 10:return Rf=Fl.X,Fl.return(Rf)}})},R5U=function(h,W){var c,V,H,B,E,J,u,d,G,Z;
return g.P(function(r){switch(r.W){case 1:return c=g.v5(),g.F(r,WZ(),2);case 2:V=r.X;if(!V){r.bB(3);break}return g.F(r,JEt(V),4);case 4:H=r.X;case 3:var q=H;B={context:g.pV(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:h},offlineClientState:q,clientStateRequestData:{preferredFormatType:W}}}};E=g.OA(df6);g.Qp(r,5);u={h7:!0};return g.F(r,g.CE(c,B,E,void 0,u),7);case 7:J=r.X;g.AN(r,6);break;case 5:d=g.CU(r);if(d instanceof g.NE)throw G=
"DPS network manager error for smart downloads: "+d.message,sU(G,d),Error(G);sU("DPS fetch request error for smart downloads",d);throw Error("DPS fetch request error for smart downloads");case 6:Z=MR(J);if(J)Z!==void 0&&Ff(Z,"smart downloads");else throw sU("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return r.return(J)}})},ZO2=function(h,W){var c,V,H,B,E,J,u,d;
return g.P(function(G){switch(G.W){case 1:return c=g.v5(),V={context:g.pV(),videoPlaybackPositionEntities:h,lastSyncTimestampUsec:W},H=g.OA(Gic),g.Qp(G,2),E={h7:!0},g.F(G,g.CE(c,V,H,void 0,E),4);case 4:B=G.X;g.AN(G,3);break;case 2:J=g.CU(G);if(J instanceof g.NE)throw u="VPPS network manager error: "+J.message,sU(u,J),Error(u);sU("VPPS fetch request error",J);throw Error("VPPS fetch request error");case 3:d=MR(B);if(B)d!==void 0&&Ff(d,"position sync");else throw sU("Network request failed for position sync"),
Error("Network request failed for position sync");return G.return(B)}})},q52=function(h,W,c){var V,H,B,E,J,u,d,G;
return g.P(function(Z){switch(Z.W){case 1:V=g.v5();var r=c.refreshData,q=c.isEnqueuedForExpiredStreamUrlRefetch,x=c.OB,z=c.offlineSourceData,L=c.mediaCapabilities,M={entityKey:h};r&&(M.refreshData=r);q&&(M.isExpiredStreamUrlRefetch=q);x&&(M.downloadParameters=x);z&&(M.offlineSourceData=z);r={context:g.nQ(W),signatureTimestamp:20292,videos:[M]};L&&(r.mediaCapabilities=L);H=r;B=g.OA(rjU);g.Qp(Z,2);J={h7:!0};return g.F(Z,g.CE(V,H,B,void 0,J),4);case 4:E=Z.X;g.AN(Z,3);break;case 2:u=g.CU(Z);if(u instanceof
g.NE)throw d="GetPDE network manager error: "+u.message,sU(d,u),Error(d);sU("GetPDE fetch request error",u);throw Error("GetPDE fetch request error");case 3:G=MR(E);if(E)G!==void 0&&Ff(G,"PDE");else throw sU("Network request failed for PDE"),Error("Network request failed for PDE");return Z.return(E)}})},MR=function(h){var W;
return(W=h.errorMetadata)==null?void 0:W.status},Ff=function(h,W){W=W?" for "+W:"";
if(h===0)throw h="Empty response body"+W,sU(h),Error(h);h="Response with error"+W;sU(h);throw Error(h);},HOX=function(h){var W,c,V,H,B,E,J,u;
return g.P(function(d){switch(d.W){case 1:return W=g.v5(),c=$Vc(h),V=g.OA(xfU),g.Qp(d,2),B={h7:!0},g.F(d,g.CE(W,c,V,void 0,B),4);case 4:H=d.X;g.AN(d,3);break;case 2:E=g.CU(d);if(E instanceof g.NE)throw J="offlinePlaylistSyncCheck network manager error: "+E.message,sU(J,E),Error(J);sU("offlinePlaylistSyncCheck fetch request error",E);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:u=MR(H);if(!H)throw sU("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(u!==void 0)Ff(u,"playlist sync");else if(!H.offlinePlaylistSyncCheckDatas||!H.offlinePlaylistSyncCheckDatas.length)throw sU("No data for playlist sync"),Error("No data for playlist sync");return d.return(H.offlinePlaylistSyncCheckDatas.map(function(G){return G.offlinePlaylistSyncCheckData}))}})},yF=function(h){this.X=h},ly6=function(h,W){var c,V,H,B,E,J;
return g.P(function(u){switch(u.W){case 1:c=new Map,V=g.e(W),H=V.next();case 2:if(H.done){u.bB(4);break}B=H.value;E=c;J=E.set;return g.F(u,h.W(B),5);case 5:J.call(E,B,u.X);H=V.next();u.bB(2);break;case 4:return u.return(c)}})},PZ=function(h,W,c,V,H,B){W=g.Ib(W,c);
V=Object.assign({},B,{priority:V,retryScheduleIntervalsInSeconds:H});return{actionType:h,entityKey:W,actionMetadata:V}},fd=function(h,W,c,V,H,B){this.status=h;
this.X=W;this.Y=c;this.W=V;this.G=H;this.downloadState=B},n$c=function(h,W,c){this.X=h;
this.uB=W;this.G=c},e5f=function(h,W){var c,V,H,B,E,J,u,d,G;
return g.P(function(Z){switch(Z.W){case 1:return c=W.entityKey,H=(V=g.v(W.actionMetadata,bk))==null?void 0:V.isEnqueuedForExpiredStreamUrlRefetch,g.Qp(Z,2),B=void 0,g.F(Z,jD6(h,W),4);case 4:B=Z.X;g.Qp(Z,5);var r=(r=g.v(W.actionMetadata,bk))?{maximumDownloadQuality:r.maximumDownloadQuality}:void 0;return g.F(Z,q52(c,h.uB,{isEnqueuedForExpiredStreamUrlRefetch:H,OB:r,offlineSourceData:B}),7);case 7:E=Z.X;g.AN(Z,6,2);break;case 5:return g.CU(Z,2),J=uk(W)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",sU("PDE handleAdd error"),Z.return(Tg(W,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",J,"DOWNLOAD_STATE_FAILED"));case 6:return g.F(Z,ay2(h,E,W),8);case 8:return Z.return(Tg(W,!0,E.orchestrationActions));case 2:return u=g.CU(Z),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.JZ&&u.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),sU("PDE handleAdd error"),Z.return(Tg(W,!1,void 0,d,G,"DOWNLOAD_STATE_FAILED"))}})},Ls6=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL;
return g.P(function(Rk){switch(Rk.W){case 1:return c=W.entityKey,V=g.pP(c).entityId,g.F(Rk,Di(h.X,{mode:"readonly",nJ:!0},function(JN){var Wd=oh(JN,c,"playbackData"),Uv=oh(JN,g.Ib(V,"offlineVideoPolicy"),"offlineVideoPolicy");JN=oh(JN,g.Ib(V,"transfer"),"transfer");return g.x4.all([Wd,Uv,JN])}),2);
case 2:H=Rk.X;B=g.e(H);E=B.next().value;J=B.next().value;u=B.next().value;d=E;G=J;Z=u;if(!d||!G)return Rk.return(Tg(W,!0));r=[];z=((x=d)==null?0:x.playerResponseJson)?JSON.parse(d.playerResponseJson):null;if(!(Z&&z&&h.uB.j("html5_refresh_deprecated_downloads"))){Rk.bB(3);break}q=z56(h,z,Z);return g.F(Rk,QDU(h,Z),4);case 4:r=Rk.X;case 3:L={lastPlayerResponseTimestampSeconds:d.playerResponseTimestamp,offlineToken:G.offlineToken,formatIds:r};M={};if((U=Z)==null?0:U.maximumDownloadQuality)M.maximumDownloadQuality=
Z.maximumDownloadQuality;g.Qp(Rk,5);y=void 0;return g.F(Rk,jD6(h,W),7);case 7:return y=Rk.X,g.Qp(Rk,8),g.F(Rk,q52(c,h.uB,{refreshData:L,OB:M,offlineSourceData:y,mediaCapabilities:q}),10);case 10:T=Rk.X;g.AN(Rk,9,5);break;case 8:return g.CU(Rk,5),m=uk(W)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",sU("PDE handleRefresh error"),Rk.return(Tg(W,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",m,
"DOWNLOAD_STATE_FAILED"));case 9:return g.F(Rk,ay2(h,T,W),11);case 11:return Rk.return(Tg(W,!0,T.orchestrationActions));case 5:return D=g.CU(Rk),O="PDE handleRefresh error",D instanceof Error&&(O="PDE handleRefresh error: "+D.message),Bd="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",qL="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.JZ&&D.type==="QUOTA_EXCEEDED"&&(Bd="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",qL="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
sU(O),Rk.return(Tg(W,!1,void 0,Bd,qL,"DOWNLOAD_STATE_FAILED"))}})},jD6=function(h,W){var c,V,H,B;
return g.P(function(E){if(E.W==1)return c=g.pP(W.entityKey).entityId,V=g.Ib(c,"videoDownloadContextEntity"),g.F(E,ki(h.X,V,"videoDownloadContextEntity"),2);H=E.X;return(B=H)!=null&&B.offlineModeType?E.return({offlineModeType:H.offlineModeType}):E.return(void 0)})},ay2=function(h,W,c){var V,H,B,E,J;
return g.P(function(u){if(u.W==1){if(!W.frameworkUpdates||!g.v(W.frameworkUpdates,Ld))return u.return();if(!(g.v(W.frameworkUpdates,Ld).mutations&&g.v(W.frameworkUpdates,Ld).mutations.length>0&&g.v(W.frameworkUpdates,Ld).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return u.bB(2);V=g.pP(g.v(W.frameworkUpdates,Ld).mutations[0].entityKey).entityId;return g.F(u,ik(h.X,V),3)}if(u.W!=2){H=u.X;B=g.v(c.actionMetadata,bk);if(J=(E=B)==null?void 0:E.playlistId)H.playlistId=J;H.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.lo(h.uB)?g.F(u,QF(V,h.X,c,h.G,H),2):g.CV(h.uB)?g.F(u,Kd(V,h.X,c,h.G),2):u.bB(2)}return g.F(u,OW$(g.v(W.frameworkUpdates,Ld)),0)})},Tg=function(h,W,c,V,H,B){return new fd(W?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",uk(h),c,V,H,B)},z56=function(h,W,c){W=FVl(h.uB,c.cotn,W);
c=g.UP(W);return g.l$D(W,c,h.uB)},QDU=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r;
return g.P(function(q){if(q.W==1)return c=[],g.F(q,Di(h.X,{mode:"readonly",nJ:!0},function(x){var z=[],L=W.offlineVideoStreams;if(L){L=g.e(L);for(var M=L.next();!M.done;M=L.next())z.push(oh(x,M.value,"offlineVideoStreams"))}return g.x4.all(z)}),2);
if(V=q.X)for(H=g.e(V),B=H.next();!B.done;B=H.next())if(E=B.value,J=void 0,(J=E)==null?0:J.streamsProgress)for(u=E.streamsProgress,d=0;d<u.length;d++)G=u[d],Z=JSON.parse(G.formatStreamBytes),r={itag:Z.itag,lmt:Z.lastModified,xtags:Z.xtags},c.push(r);return q.return(c)})},iO2=function(h,W){this.X=h;
this.uB=W},Kst=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q;
return g.P(function(x){switch(x.W){case 1:return c=uk(W),g.F(x,hf(h.X,"videoPlaybackPositionEntity"),2);case 2:V=x.X;if(V.length===0)return x.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Qp(x,3);return g.F(x,td.getInstance(),5);case 5:H=x.X;if(!H)throw Error("prefStorage is undefined");return g.F(x,H.get("psi"),6);case 6:return B=x.X,u=(J=(E=B)==null?void 0:E.pV)!=null?J:"0",g.F(x,ZO2(V,u),7);case 7:return d=x.X,G={isPaused:d.watchHistoryPaused,pV:d.syncTimestampUsec},g.F(x,H.set("psi",
G),8);case 8:if(G.isPaused){x.bB(9);break}Z=g.v(d.frameworkUpdates,Ld);if(!d.frameworkUpdates||!Z){x.bB(9);break}return g.F(x,OW$(Z),9);case 9:g.AN(x,4);break;case 3:return r=g.CU(x),q="PPE handleRefresh error: "+(r instanceof Error?r.message:"unknown error"),sU(q),x.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return x.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},Uf2=function(h,W){var c,V,H,B,E,J,u,d;
return g.P(function(G){switch(G.W){case 1:return c=uk(W),V=g.pP(W.entityKey).entityId,g.Qp(G,2),g.F(G,td.getInstance(),4);case 4:H=G.X;if(!H)throw Error("prefStorage is undefined");return g.F(G,H.get("psi"),5);case 5:B=G.X;E=g.v(W.actionMetadata,Ajc);if(((J=B)==null?void 0:J.isPaused)!==!1||(u=E)==null||!u.lastPlaybackPositionSeconds){G.bB(6);break}d={key:g.Ib(V,"videoPlaybackPositionEntity"),videoId:V,lastPlaybackPositionSeconds:E.lastPlaybackPositionSeconds};return g.F(G,wq(h.X,d,"videoPlaybackPositionEntity"),
6);case 6:g.AN(G,3);break;case 2:return g.CU(G),G.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},Cel=function(h,W){var c,V,H;
return g.P(function(B){switch(B.W){case 1:c=uk(W);g.Qp(B,2);V=g.pP(W.entityKey).entityId;if(V==="!*$_ALL_ENTITIES_!*$")return g.F(B,mdI(h.X),5);H=g.Ib(V,"videoPlaybackPositionEntity");return g.F(B,vvS(h.X,H),5);case 5:g.AN(B,3);break;case 2:return g.CU(B),B.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},MEI=function(h,W){this.api=h;
this.X=W;this.logger=new g.xP("woffle");this.W=!1;this.uX={mq:this.mq};this.logger.debug("Initialized OfflineMediaManager")},Fs6=function(h){return g.P(function(W){return W.return(WVX(h))})},yjU=function(h){var W;
return g.P(function(c){if(c.W==1)return g.F(c,g.Sil(h),2);W=c.X;return c.return(W.filter(function(V){return!!V.url}).map(function(V){return V.url}))})},NR=function(h,W){var c=g.kX(W);
if(c===1||c===0)return Promise.resolve();(c=Pec(h,W))&&c.stopVideo();h.G=0;return Fs6(W)},Xf=function(h,W,c,V){c=c===void 0?!1:c;
V=V===void 0?!0:V;var H=typeof W==="string"?W:W.videoDetails.videoId;g.kX(H)===2&&((W=Pec(h,H))?W.stopVideo():h.logger.info(function(){return"Corresponding player for "+H+" not found. Pausing anyway"}),g.hT(H,2),h.G=2,c?fyl(h.X):V&&bOf(h.X))},Pec=function(h,W){var c;
return((c=h.player)==null?void 0:c.getVideoData().videoId)===W?h.player:null},TH2=function(h,W,c){W.getPlayerResponse();
g.hT(W.videoId,2);h.G=2;h.W=!1;var V;(V=h.player)==null||V.dispose();h.player=h.api.nC(W);W={};h.player.BY((W.localmediachange=h.Fc,W.signatureexpired=h.Eg,W.statechange=h.uAM,W),h);h.j("html5_generate_content_po_token")&&h.player.l1();var H=h.mq(c);h.player.t5(g.zV(H,H,!0,"m"),!1);h.logger.debug(function(){return"Starting headless playback with quality: "+H});
h.player.bj(!1)},NHf=function(h,W){this.X=h;
this.uB=W},tEK=function(h,W){var c,V;
return g.P(function(H){switch(H.W){case 1:return c=uk(W),g.F(H,ki(h.X,W.entityKey,"transfer"),2);case 2:if(V=H.X)return H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Qp(H,3);return g.F(H,Xyl(h,W),5);case 5:g.AN(H,4);break;case 3:return g.CU(H),H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},v$6=function(h,W){var c,V;
return g.P(function(H){switch(H.W){case 1:return c=uk(W),g.F(H,ki(h.X,W.entityKey,"transfer"),2);case 2:V=H.X;if(!V||V.transferState!=="TRANSFER_STATE_COMPLETE")return H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Qp(H,3);return g.F(H,Xyl(h,W,!0),5);case 5:g.AN(H,4);break;case 3:return g.CU(H),H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},mfU=function(h,W){var c,V,H,B,E,J,u,d,G,Z;
return g.P(function(r){switch(r.W){case 1:return c=uk(W),V=g.pP(W.entityKey).entityId,g.F(r,Di(h.X,{mode:"readonly",nJ:!0},function(q){var x=oh(q,W.entityKey,"transfer");q=oh(q,g.Ib(V,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.x4.all([x,q])}),2);
case 2:H=r.X;B=g.e(H);E=B.next().value;J=B.next().value;u=E;d=J;if(!u||u.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return r.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Qp(r,3);u.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.F(r,wq(h.X,u,"transfer"),5);case 5:G=g.pP(u.key).entityId;ieu({videoId:G,p$:u,offlineModeType:(Z=d)==null?void 0:Z.offlineModeType});g.AN(r,4);break;case 3:return g.CU(r),r.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return r.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},Xyl=function(h,W,c){c=c===void 0?!1:c;
var V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M;return g.P(function(U){switch(U.W){case 1:return V=g.v(W.actionMetadata,o$l),H=g.pP(W.entityKey).entityId,B=g.Ib(H,"downloadStatusEntity"),g.F(U,Di(h.X,{mode:"readonly",nJ:!0},function(y){var T=oh(y,B,"downloadStatusEntity");y=oh(y,g.Ib(H,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.x4.all([T,y])}),2);
case 2:return E=U.X,J=g.e(E),u=J.next().value,d=J.next().value,G=u,Z=d,r="TRANSFER_STATE_TRANSFER_IN_QUEUE",((q=G)==null?void 0:q.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(r="TRANSFER_STATE_PAUSED_BY_USER"),L={key:W.entityKey,transferState:r,cotn:g.Ge(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(x=V)==null?void 0:x.maximumDownloadQuality,preferredAudioTrack:(z=V)==null?void 0:z.preferredAudioTrack,transferRetryCount:0,isRefresh:c,hasLoggedFirstStarted:!1},g.F(U,Di(h.X,
{mode:"readwrite",nJ:!0},function(y){var T=[];c&&T.push(O3(y,g.Ib(H,"offlineVideoStreams")));T.push(Yi(y,L,"transfer"));return g.x4.all(T)}),3);
case 3:if(!c){U.bB(4);break}return g.F(U,Fs6(H),4);case 4:Q_2({videoId:H,p$:L,offlineModeType:(M=Z)==null?void 0:M.offlineModeType}),g.zQ(U)}})},IyI=function(h,W,c,V){if(!h.action.entityKey)throw Error("entityKey is missing.");
var H=g.pP(h.action.entityKey);H={entityType:H.bv,entityId:H.entityId,offlineOrchestrationActionType:h.action.actionType,orchestrationAction:{orchestrationActionId:h.actionId}};W&&(H.offlineOrchestrationActionResult=W.status,H.isRetryable=c?!1:W.X,W.G&&(H.offlineOrchestrationFailureReason=py$(W.G,H.isRetryable)));var B,E;if((B=h.action.actionMetadata)==null?0:(E=B.offlineLoggingData)==null?0:E.offlineModeType)H.offlineModeType=h.action.actionMetadata.offlineLoggingData.offlineModeType;V&&(H.additionalOrchestrationActions=
V.map(function(J){return{orchestrationActionId:J.actionId}}));
return H},py$=function(h,W){return h!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||W?h==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&W?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":h:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},Y52=function(h,W){var c={offlineOrchestrationContext:IyI(h)};
W=EQc(W,c);Ru$(Bl2(),W,h.rootActionId)},OO$=function(h,W,c,V){V=V===void 0?[]:V;
W={offlineOrchestrationContext:IyI(h,W,c,V)};W=EQc(3,W);Ru$(Bl2(),W,h.rootActionId)},S56=function(){this.actions=[]},g$U=function(h,W){W=g.e(W);
for(var c=W.next();!c.done;c=W.next())c=c.value,Y52(c,1),h.actions.push(c);h.actions.sort(h.X)},DfU=function(h,W){if(W)for(var c=0;c<h.actions.length;c++)if(W==="!*$_ALL_ENTITIES_!*$"&&h.actions[c].actionId!==W||W!=="!*$_ALL_ENTITIES_!*$"&&h.actions[c].rootActionId===W&&h.actions[c].actionId!==W)h.actions.splice(c,1),c--},wy6=function(h,W){h=g.e(h.actions);
for(var c=h.next();!c.done;c=h.next())if(c.value.actionId===W)return!0;return!1},tf=function(h,W,c,V,H){g.N.call(this);
var B=this;this.W=h;this.Pk=W;this.XI=c;this.S=V;this.uB=H;this.X=new S56;this.N=new g.TZ;this.G=new g.oD(function(){B.retry()});
this.Z=NaN;this.C=!1;this.uX={LHE:function(){return B.X},
WI:function(){return B.N},
gqk:function(){return B.G},
retry:function(){return B.retry()}};
g.X(this,this.G);this.T=this.W.observe(this.Wk.bind(this))},WWX=function(h,W,c,V,H){var B;
return g.P(function(E){if(E.W==1)return B=new tf(h,W,c,V,H),g.F(E,kiI(B),2);hpU(B);return E.return(B)})},hpU=function(h){var W=h.X.actions[0];
return h.Y?((W==null?void 0:W.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&h.Y[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(h.C=!0),Promise.resolve()):cet(h)},cet=function(h){var W,c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M;
return g.P(function(U){switch(U.W){case 1:if(h.Y)throw Error("Already processing an action");if(h.gE())return U.return();W=h.X.actions.shift();eu6(h.XI,!W);if(W===void 0)return U.return();W.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&W.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&DfU(h.X,W.actionId);c="";W.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&W.rootActionId===W.actionId&&(c=W.actionId);V=[W];h.Y=V;if(H=h.Pk[W.entityType]){U.bB(2);break}h.Y=
void 0;return g.F(U,cet(h),3);case 3:return U.return();case 2:B=g.e(V);for(E=B.next();!E.done;E=B.next())J=E.value,Y52(J,2);g.Qp(U,4,5);return g.F(U,ly6(H,V.map(function(y){return y.action})),7);
case 7:u=U.X,d=g.e(V),G=d.next();case 8:if(G.done){U.bB(10);break}Z=G.value;r=u.get(Z.action);return g.F(U,VQ2(h,Z,r),9);case 9:G=d.next();U.bB(8);break;case 10:DfU(h.X,c);case 5:g.Pd(U);h.Y=void 0;g.bT(U,6);break;case 4:return q=g.CU(U),sU("Orchestration error",q),g.Qp(U,12),g.F(U,$Mt(h,V),14);case 14:g.AN(U,5);break;case 12:x=g.CU(U);sU("Orchestration retry error",x);z=g.e(V);for(L=z.next();!L.done;L=z.next())M=L.value,M.retryScheduleIndex<3&&g$U(h.X,[M]);U.bB(5);break;case 6:return g.F(U,cet(h),
0)}})},VQ2=function(h,W,c){var V,H,B,E,J,u,d,G,Z,r,q,x;
return g.P(function(z){switch(z.W){case 1:V=W.retryScheduleIndex+2===3;if(c.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){z.bB(2);break}if(c.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){z.bB(0);break}OO$(W,c,V);if(c.X&&W.retryScheduleIndex+1<3)return g.F(z,$Mt(h,[W]),0);B=((H=c)==null?0:H.W)?c.W:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";E={entityKey:W.action.entityKey,failureReason:B};J=void 0;g.lo(h.uB)?J="mainVideoDownloadStateEntity":g.CV(h.uB)&&(J="musicTrackDownloadMetadataEntity");
if(!J||!c.downloadState){z.bB(7);break}u=g.pP(W.action.entityKey).entityId;return g.F(z,rB(u,J,h.W,c.downloadState),7);case 7:BZ(h.S,E);if(c.downloadState==="DOWNLOAD_STATE_FAILED"&&h.uB.j("html5_auto_retry_failed_pde_actions")){z.bB(0);break}sU("Orchestration result is not retryable, deleting action");return g.F(z,vvS(h.W,aF(W).key),0);case 2:d=void 0;try{d=(G=c.Y)==null?void 0:G.map(function(L){return h.createAction(L,W)})}catch(L){return OO$(W,c,V),Z={entityKey:W.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},BZ(h.S,Z),sU("Orchestration subactions creation error",L),z.return()}OO$(W,c,V,d);if(!d){z.bB(12);break}r=d.map(function(L){return aF(L)});
q=0;case 13:if(!(q<d.length)||h.C){z.bB(15);break}return g.F(z,Di(h.W,{mode:"readwrite",nJ:!0},function(L){var M=[];M.push(MaI(L,r.slice(q,q+10),"offlineOrchestrationActionWrapperEntity"));return g.x4.all(M)}),16);
case 16:q+=10;z.bB(13);break;case 15:if(h.C)return h.C=!1,z.return();case 12:return x=aF(W),g.F(z,vvS(h.W,x.key),17);case 17:Y52(W,4),g.zQ(z)}})},Ey6=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q;
return g.P(function(x){c=[];V=Infinity;H=4E3;B=g.e(W);for(E=B.next();!E.done;E=B.next())J=E.value,u=Number(J.enqueueTimeSec),d=sr6(u),G=J.retryScheduleIndex,Z=G!=null&&G>0,d>0&&Z?(V=Math.min(V,u),H=Math.min(d,H)):c.push(J);isFinite(V)&&(!h.G.isActive()||V<h.Z)&&(h.Z=V,h.G.start(H));h.N.zj()||(r=c.length,c=c.filter(function(z){var L;z=((L=z.actionProto)==null?void 0:L.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Hc$.includes(z)}),q=c.length<r,!h.G.isActive()&&q&&h.G.start(1));
c.length>0&&BS2(h,c);return g.F(x,hpU(h),0)})},Je2=function(h){var W,c,V,H,B,E,J;
return g.P(function(u){if(u.W==1)return g.F(u,Rpl(h),2);W=u.X;c=[];V=g.e(W);for(H=V.next();!H.done;H=V.next())B=H.value,E=g.pP(B.key),J=E.entityId,wy6(h.X,J)||c.push(B);return g.F(u,Ey6(h,c),0)})},sr6=function(h){h=h*1E3-Date.now();
return h>4E3?4E3:h},$Mt=function(h,W){var c,V,H;
return g.P(function(B){c=g.e(W);for(V=c.next();!V.done;V=c.next()){H=V.value;var E=void 0,J=void 0,u=((J=H.action)==null?void 0:(E=J.actionMetadata)==null?void 0:E.retryScheduleIntervalsInSeconds)||[1,2,4];E=1;H.retryScheduleIndex<u.length&&(E=u[H.retryScheduleIndex]);H.X=E*1E3+Date.now();H.retryScheduleIndex++}return g.F(B,uS$(h,W),0)})},kiI=function(h){var W;
return g.P(function(c){if(c.W==1)return g.F(c,hf(h.W,"offlineOrchestrationActionWrapperEntity"),2);W=c.X;return g.F(c,Ey6(h,W),0)})},BS2=function(h,W){W.length!==0&&W.forEach(function(c){c=jh(c);
c.retryScheduleIndex<3&&g$U(h.X,[c])})},Rpl=function(h,W){var c;
return g.P(function(V){if(V.W==1)return g.F(V,hf(h.W,"offlineOrchestrationActionWrapperEntity",W),2);c=V.X;return V.return(c.filter(SLU))})},uS$=function(h,W){if(W.length===0)return Promise.resolve([]);
W=W.map(function(c){return aF(c)});
return taf(h.W,W)},dM$=function(h){this.qn=h;
this.X=void 0},G$U=function(h,W){var c,V,H,B;
return g.P(function(E){c=W.videoId;V=!0;if(W.captionTracks.length)H=Q8K(W),h.X=new g.C3(h.qn,W,H);else if(W.BV)B=g.Vo7(W),h.X=new g.FV(h.qn,W.BV,c,B,W.Xt,W.eventId),V=W.Xt;else return E.return();return E.return(new Promise(function(J){var u;(u=h.X)==null||u.Mj({UJ:function(){return g.P(function(d){if(d.W==1)return g.F(d,h.UJ(c,V),2);J();g.zQ(d)})},
wf:function(){}})}))})},ZcX=function(h){var W;
return g.P(function(c){if(c.W==1)return g.F(c,huI(h),2);W=c.X;return c.return(!!W&&W.length>0)})},vZ=function(h){g.N.call(this);
this.X=h;this.W=this.X.observe(this.G.bind(this))},reU=function(h,W){var c,V,H,B,E,J,u;
return g.P(function(d){switch(d.W){case 1:if(W.length===0)return d.return([]);c=W.map(function(G){return g.Ib(G,"transfer")});
return g.F(d,hf(h.X,"transfer",c),2);case 2:V=d.X;H=V.filter(SLU).map(function(G){return g.pP(G.key).entityId});
B=W.filter(function(G){return H.indexOf(G)===-1});
if(B.length===0)return d.return([]);E=g.e(B);J=E.next();case 3:if(J.done){d.bB(5);break}u=J.value;return g.F(d,Fs6(u),4);case 4:J=E.next();d.bB(3);break;case 5:return d.return(B)}})},l_2=function(h,W,c,V,H,B){var E,J,u;
return g.P(function(d){E="STREAM_TYPE_UNKNOWN";c.video&&c.audio?(E="STREAM_TYPE_AUDIO_AND_VIDEO",sU("unexpected stream type")):c.video&&!c.audio?E="STREAM_TYPE_VIDEO":!c.video&&c.audio&&(E="STREAM_TYPE_AUDIO");J=g.Ib(W,"offlineVideoStreams");u={numBytesDownloaded:H.toFixed(),numTotalBytes:B.toFixed(),streamType:E,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(V),itag:E==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(c.itag):void 0};return g.F(d,Di(h,{mode:"readwrite",nJ:!0},
function(G){var Z=oh(G,J,"offlineVideoStreams"),r=oh(G,g.Ib(W,"transfer"),"transfer");return g.x4.all([Z,r]).then(function(q){q=g.e(q);var x=q.next().value;q=q.next().value;if(!q)return O3(G,J).then(function(){});
var z=qbf(x);x=xMl(x,V,u,J);var L=Yi(G,x,"offlineVideoStreams");qbf(x)>z&&(q.lastProgressTimeMs=Date.now().toString());z=[L];q.offlineVideoStreams||(q.offlineVideoStreams=[]);q.offlineVideoStreams.indexOf(J)===-1&&(q.offlineVideoStreams.push(J),z.push(Yi(G,q,"transfer")));return g.x4.all(z)})}),0)})},nyI=function(h,W){var c,V,H,B,E;
return g.P(function(J){if(J.W==1)return c=g.Ib(W,"offlineVideoStreams"),g.F(J,ki(h,c,"offlineVideoStreams"),2);V=J.X;if(!V||!V.streamsProgress)return J.return();H=g.e(V.streamsProgress);for(B=H.next();!B.done;B=H.next())E=B.value,E.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",E.numTotalBytes!==E.numBytesDownloaded&&(E.numBytesDownloaded=E.numTotalBytes);return g.F(J,wq(h,V,"offlineVideoStreams"),0)})},xMl=function(h,W,c,V){if(h&&h.streamsProgress){V=h;
a:{W=W.itag+";"+W.xtags;for(var H=h.streamsProgress,B=0;B<H.length;B++){var E=JSON.parse(H[B].formatStreamBytes);if(E.itag+";"+E.xtags===W){H[B]=c;c=H;break a}}H.push(c);c=H}V.streamsProgress=c}else h={key:V,streamsProgress:[c]};return h},qbf=function(h){if(h==null?0:h.streamsProgress){var W=0;
h=h.streamsProgress;for(var c=0;c<h.length;c++){var V=h[c];isNaN(Number(V.numBytesDownloaded))?sU("stream progress bytes number invalid"):W+=Number(V.numBytesDownloaded)}return W}return 0},jr6=function(h,W,c,V){g.N.call(this);
var H=this;this.W=h;this.api=W;this.Rz=c;this.Wk=V;this.N=new g.TZ;this.Y=new g.oD(function(){H.X&&H.X.transferState==="TRANSFER_STATE_TRANSFERRING"&&H.N.zj()&&((H.X.transferRetryCount||0)<3?Xf(H.S,H.C,!1,!1):NR(H.S,H.C.videoDetails.videoId),H.LX("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.XI=this.zV=0;this.T=this.Z=!1;this.yg=g.DF(this.api.B().experiments,"html5_transfer_processing_logs_interval");this.CM=new g.lX(this);this.uX={U9W:function(){return H.Y},
hkN:function(){return H.Wk},
WI:function(){return H.N}};
this.Pk=this.W.observe(this.N4.bind(this));this.S=new MEI(W,this);this.Jk=new dM$(W);this.DH=new vZ(this.W);this.Nn=this.N.listen("publicytnetworkstatus-online",this.F3.bind(this));this.mW=this.N.listen("publicytnetworkstatus-offline",this.sTV.bind(this));this.T=this.api.B().j("html5_less_transfer_processing_logs");g.X(this,this.CM);this.CM.U(W,"offlinetransferpause",this.U$O);if(g.lo(this.api.B()))this.G="mainVideoDownloadStateEntity";else if(g.CV(this.api.B())||g.jz(this.api.B()))this.G="musicTrackDownloadMetadataEntity"},
a_U=function(h){return g.P(function(W){if(W.W==1)W=g.F(W,wKU(),2);
else{var c=h.DH;var V=g.wu();V=Object.keys(V);c=reU(c,V);W=g.F(W,c,0)}return W})},oF=function(h,W){W=W===void 0?!1:W;
var c;return g.P(function(V){if(V.W==1){if(h.X)throw Error("Already downloading a video");h.XI=0;h.Z=!1;return g.F(V,ep2(h),2)}return V.W!=4?(c=V.X,zuK(h.Rz,!c),c&&h.N.zj()?W?g.F(V,new Promise(function(H){g.Rx(H,1E3)}),4):V.bB(4):(!c&&h.X&&mT(h),V.bB(0))):g.F(V,zpS(h,c),0)})},Qr6=function(h){return g.P(function(W){if(W.W==1)return h.C?g.F(W,NR(h.S,h.C.videoDetails.videoId),3):W.bB(0);
mT(h);g.zQ(W)})},LW6=function(h,W){var c,V,H;
return g.P(function(B){switch(B.W){case 1:return g.Qp(B,2),(c=!!W.captionTracks.length||!!W.BV)?g.F(B,ZcX(W.videoId),4):B.return();case 4:return(V=B.X)?B.return():g.F(B,G$U(h.Jk,W),5);case 5:g.AN(B,0);break;case 2:H=g.CU(B),sU("Caption downloading error",H,W.cotn),g.zQ(B)}})},zpS=function(h,W){var c,V,H,B,E,J;
return g.P(function(u){switch(u.W){case 1:if(h.Z)return u.return();h.Z=!0;h.X=W;c=g.pP(h.X.key);V=c.entityId;H=void 0;if(h.X.transferState==="TRANSFER_STATE_TRANSFERRING")return g.F(u,pd(h,V),7);if(h.X.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||h.X.transferRetryCount||h.X.hasLoggedFirstStarted){u.bB(3);break}return g.F(u,pd(h,V),5);case 5:return H=u.X,h.X.hasLoggedFirstStarted=!0,g.F(u,icX(h),6);case 6:LV6({videoId:V,p$:h.X,offlineModeType:H},void 0,void 0,!0);u.bB(3);break;case 7:H=u.X,
Jf({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:V,p$:h.X,offlineModeType:H});case 3:return g.F(u,KWl(h),8);case 8:return B=null,g.Qp(u,9),g.F(u,Ae$(h,W),11);case 11:B=u.X;h.C=B;g.AN(u,10);break;case 9:return E=g.CU(u),sU("error getting player response",E,W.cotn),g.F(u,h.LX("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return u.return();case 10:return J=FVl(h.api.B(),W.cotn,B),g.F(u,LW6(h,J),13);case 13:return g.F(u,yjU(J.videoId),
14);case 14:J.Nf=u.X,TH2(h.S,J,W.maximumDownloadQuality),h.Y.start(108E5),g.zQ(u)}})},ep2=function(h){var W,c;
return g.P(function(V){if(V.W==1)return g.F(V,hf(h.W,"transfer"),2);W=V.X;c=W.filter(UMI).sort(C22);return c.length===0?V.return():V.return(c[0])})},KWl=function(h){var W,c,V;
return g.P(function(H){if(H.W==1){if(!h.X)return IF(h,"onTransferStart"),H.return();h.Y.start(108E5);return g.F(H,Ym(h,"TRANSFER_STATE_TRANSFERRING"),2)}W=h.X;return(V=((c=W)==null?0:c.key)?g.pP(W.key).entityId:"")&&h.G?g.F(H,rB(V,h.G,h.W,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):H.bB(0)})},fyl=function(h){var W,c,V,H;
g.P(function(B){switch(B.W){case 1:if(!h.X){IF(h,"onTransferPausedByUser");B.bB(2);break}W=h.X;h.Y.stop();return g.F(B,Ym(h,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:V=((c=W)==null?0:c.key)?g.pP(W.key).entityId:"";if(!V||!h.G){B.bB(4);break}return g.F(B,rB(V,h.G,h.W,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.F(B,pd(h,V),6);case 6:H=B.X,KVU({videoId:V,p$:W,offlineModeType:H});case 2:mT(h),oF(h),g.zQ(B)}})},bOf=function(h){var W,c,V;
g.P(function(H){if(H.W==1){if(!h.X)return IF(h,"onTransferPausedByNetwork"),H.return();h.Y.stop();return g.F(H,Ym(h,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(H.W!=3)return W=h.X,(V=((c=W)==null?0:c.key)?g.pP(W.key).entityId:"")&&h.G?g.F(H,rB(V,h.G,h.W,"DOWNLOAD_STATE_PAUSED"),3):H.bB(3);mT(h);g.zQ(H)})},MQI=function(h){var W,c,V,H,B;
g.P(function(E){switch(E.W){case 1:if(!h.X)return IF(h,"onTransferComplete"),E.return();W=h.X;h.Y.stop();if(!W||!h.C){E.bB(2);break}c=FVl(h.api.B(),W.cotn,h.C);return g.F(E,LW6(h,c),2);case 2:return g.F(E,Ym(h,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:H=((V=W)==null?0:V.key)?g.pP(W.key).entityId:"";if(!H||!h.G){E.bB(5);break}return g.F(E,rB(H,h.G,h.W,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.F(E,nyI(h.W,H),7);case 7:return g.F(E,pd(h,H),8);case 8:B=E.X,Jf({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:H,p$:W,offlineModeType:B}),mT(h),oF(h),g.zQ(E)}})},FW2=function(h,W,c){var V,H;
g.P(function(B){switch(B.W){case 1:if(!h.X)return IF(h,"onTransferProgress: "+W),B.return();if(h.X.transferState==="TRANSFER_STATE_TRANSFERRING"){B.bB(2);break}return g.F(B,KWl(h),2);case 2:V=Date.now();if(!(V-h.zV>1E3)){B.bB(4);break}h.zV=V;return g.F(B,l_2(h.W,c.videoId,c.W,c.hU,c.bytesDownloaded,c.X),5);case 5:if(h.T&&!(h.T&&V-h.XI>h.yg)){B.bB(4);break}h.XI=V;return g.F(B,pd(h,W),7);case 7:H=B.X,LV6({videoId:W,p$:h.X,offlineModeType:H},c.bytesDownloaded,c.X);case 4:h.Y.start(108E5),g.zQ(B)}})},
yeS=function(h){var W=(h.X.transferRetryCount||0)<3;
W&&(h=h.X,h.transferRetryCount=(h.transferRetryCount||0)+1);return W},P2$=function(h,W){W=W===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":W;
var c,V,H,B;return g.P(function(E){if(E.W==1)return h.X||IF(h,"setTransferToFailed: "+W),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W==="TRANSFER_FAILURE_REASON_NETWORK"?c="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":W==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.F(E,Ym(h,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",W),2);if(E.W!=3)return BZ(h.Wk,{entityKey:(V=h.X)==null?void 0:V.key,failureReason:c}),
H=h.X?g.pP(h.X.key).entityId:"",g.F(E,pd(h,H),3);B=E.X;var J={videoId:H,p$:h.X,offlineModeType:B},u=W,d={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};u&&(d.transferFailureReason=u,d.failureReason=AEu(u));Jf(d,J);g.zQ(E)})},Ym=function(h,W,c,V){var H;
return g.P(function(B){if(B.W==1){if(!h.X)return IF(h,"saveTransferState: "+W),B.return();h.X.transferState=W;h.X.failureReason=V;g.Qp(B,2);return g.F(B,icX(h,function(E){return c?ph(E,"offlineVideoStreams",h.X.offlineVideoStreams).then(function(J){for(var u=g.e(J),d=u.next();!d.done;d=u.next())if((d=d.value)&&d.streamsProgress){d=g.e(d.streamsProgress);for(var G=d.next();!G.done;G=d.next())G.value.streamState=c}return MaI(E,J.filter(function(Z){return!!Z}),"offlineVideoStreams")}):g.x4.resolve(void 0)}),
4)}if(B.W!=2)return g.AN(B,0);
H=g.CU(B);return H instanceof g.JZ&&H.type==="QUOTA_EXCEEDED"?g.F(B,h.LX("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):B.bB(0)})},icX=function(h,W){var c;
return g.P(function(V){if(!h.X)return V.return();c=h.X;return g.F(V,Di(h.W,{mode:"readwrite",nJ:!0},function(H){var B=[Yi(H,c,"transfer")];W&&B.push(W(H));return g.x4.all(B)}),0)})},mT=function(h){h.X=void 0;
h.C=void 0;h.Y.stop()},Ae$=function(h,W){var c,V,H,B,E;
return g.P(function(J){if(J.W==1)return c=g.pP(W.key),V=c.entityId,H=g.Ib(V,"playbackData"),g.F(J,ki(h.W,H,"playbackData"),2);B=J.X;if((E=B)==null?0:E.playerResponseJson)return J.return(JSON.parse(B.playerResponseJson));throw Error("No PlayerResponse found");})},IF=function(h,W){h.api.GV("woffle",{mcte:W});
sU("missing current transfer entity.")},pd=function(h,W){var c,V,H;
return g.P(function(B){if(B.W==1)return g.F(B,ki(h.W,g.Ib(W,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);c=B.X;return B.return((H=(V=c)==null?void 0:V.offlineModeType)!=null?H:void 0)})},UMI=function(h){return f_K[h.transferState]!==void 0},C22=function(h,W){var c=f_K[h.transferState],V=f_K[W.transferState];
return c!==V?c-V:Number(h.enqueuedTimestampMs)-Number(W.enqueuedTimestampMs)},OU=function(h,W){var c=this;
this.uB=h;this.api=W;this.N=new g.TZ;this.C=new g.R_;this.uX={uI:function(){return c.G.uX.uI()},
WI:function(){return c.N},
PPH:function(){return c.G},
RH:function(){return c.RH()},
eF:function(){return c.eF()},
AV:function(){return c.AV()},
YY:function(){return c.YY()},
Xr:function(){return c.Xr()},
aW:function(V){return c.aW(V)}};
this.G=new nQI(function(){return bcU(c)},function(){c.AV()},this.api.D8(),this.api.j.bind(this.api));
this.X=new HZ(this.api);j_l(this.G)},bcU=function(h){return g.P(function(W){h.api.Iz("onOrchestrationBecameLeader");
return g.F(W,h.eF(),0)})},NSc=function(h){var W,c;
return g.P(function(V){if(V.W==1)return g.F(V,WZ(),2);if(V.W!=3){W=V.X;if(!W)return sU("PES is undefined"),V.return();h.W=new jr6(W,h.api,h.G,h.X);c=h.w2(W);return g.F(V,WWX(W,c,h.G,h.X,h.uB),3)}h.S=V.X;return g.F(V,TSI(h),0)})},TSI=function(h){var W;
return g.P(function(c){switch(c.W){case 1:if(!h.W)return sU("transferManager is undefined"),c.return();if(h.W.X){c.bB(2);break}return g.F(c,oF(h.W),2);case 2:if(!h.uB.j("woffle_enable_main_downloads_library")){c.bB(4);break}return g.F(c,h.GN(),4);case 4:if(!h.uB.j("html5_offline_playback_position_sync")){c.bB(6);break}return g.F(c,h.CB(),7);case 7:return g.F(c,h.aW(864E5),6);case 6:return g.F(c,h.refreshAllStaleEntities(43200,!0),9);case 9:return g.F(c,h.hH(),10);case 10:if(!h.uB.j("html5_retry_downloads_for_expiration")){c.bB(11);
break}return g.F(c,h.Xr(),11);case 11:return h.Z=g.Jc(function(){h.refreshAllStaleEntities(43200,!0);h.hH()},9E5),g.II(g.Oh(),function(){return h.YY()}),g.F(c,WZ(),13);
case 13:return W=c.X,g.F(c,lDK(W),14);case 14:aDl(h.G),g.zQ(c)}})},XDu=function(){var h,W,c,V,H,B;
return g.P(function(E){switch(E.W){case 1:return g.F(E,WZ(),2);case 2:h=E.X;if(!h)return E.return([]);W=Date.now()/1E3;return g.F(E,hf(h,"offlineVideoPolicy"),3);case 3:c=E.X,V=g.e(c),H=V.next();case 4:if(H.done){E.bB(6);break}B=H.value;if(!(B.expirationTimestamp&&Number(B.expirationTimestamp)<W)){E.bB(5);break}B.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";B.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.F(E,wq(h,B,"offlineVideoPolicy"),5);
case 5:H=V.next();E.bB(4);break;case 6:return E.return(c.map(function(J){return J.key}))}})},Sh=function(h,W,c,V,H){var B,E,J;
return g.P(function(u){if(u.W==1)return g.F(u,WZ(),2);B=u.X;if(!B)return u.return([]);E=W.map(function(d){var G=g.Ib(d,c);G={actionType:V,entityKey:G,actionMetadata:Object.assign({},yE6(),H)};V!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(G.actionMetadata.priority=0);d=new nd(c,d,G);return aF(d)});
J=taf(B,E);j_l(h.G);return u.return(J)})},tQS=function(h,W,c,V){var H,B,E,J,u,d,G,Z;
return g.P(function(r){switch(r.W){case 1:H=[],B=g.e(W),E=B.next();case 2:if(E.done){r.bB(4);break}J=E.value;if(J.upToDate||c&&!J.shouldAutoSyncMetadata||!J.playlistId){r.bB(3);break}u={};switch(V){case "mainPlaylistEntity":d={nextAutoRefreshIntervalSeconds:J.checkInSeconds,autoSync:c};u={mainPlaylistEntityActionMetadata:d};break;case "musicPlaylist":G={autoSync:c},u={musicPlaylistEntityActionMetadata:G}}return g.F(r,Sh(h,[J.playlistId],V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",u),6);case 6:(Z=
r.X)&&H.push.apply(H,g.rN(Z));case 3:E=B.next();r.bB(2);break;case 4:return r.return(H)}})},vyc=function(h,W){var c;
return g.P(function(V){return W.length?(c=yE6(),g.Cx(c,bk,{isEnqueuedForExpiredStreamUrlRefetch:!0}),h.api.GV("qrd",{v:W.length}),V.return(Sh(h,W,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c))):V.return([])})},mMS=function(h,W,c){this.X=h;
this.uB=W;this.G=c},I_I=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U;
return g.P(function(y){switch(y.W){case 1:return c=uk(W),V=g.pP(W.entityKey),H=V.entityId,B=[],g.Qp(y,2),g.F(y,oy6(h,H),4);case 4:B=y.X;if(!(h.uB.j("woffle_enable_main_downloads_library")&&((E=B)==null?0:E.length))){y.bB(5);break}return g.F(y,YEU(h.X,[W.entityKey]),5);case 5:g.AN(y,3);break;case 2:return J=g.CU(y),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.JZ&&J.type==="QUOTA_EXCEEDED"?(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):sU("Playlist add error"),y.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,u,d));case 3:G=[];if(!h.uB.j("html5_offline_prevent_redownload_downloaded_video")){y.bB(7);break}return g.F(y,Mcf(h.X,"mainVideoEntity",B),8);case 8:B=y.X;case 7:if((Z=B)==null?0:Z.length)for(r=g.e(B),q=r.next();!q.done;q=r.next())if(x=q.value,z=x.offlineVideoData,L=void 0,(L=z)==null?0:L.videoId)M=void 0,U=Number(((M=W.actionMetadata)==null?void 0:M.priority)||
0)+1,G.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",z.videoId,"mainVideoEntity",U,gB,pDU(W,z,H)));return y.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,G))}})},Oct=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf,Fl,BG,Tt,p$,EO,C,tB,yU,Vp,iK,Q,cd,Fa,R0,v2,Ov,VU,hk,vG,K,a,A,f,t,GQ,I,k,b,fU,ok,Ev,dX,yp,iT,c3,L$,Nu,KU,Q_,ML,P2,K$;
return g.P(function(RJ){switch(RJ.W){case 1:return c=uk(W),V=W.entityKey,H=g.pP(V).entityId,B=[],E=!1,H==="!*$_ALL_ENTITIES_!*$"?(E=!0,g.F(RJ,hf(h.X,"mainPlaylistEntity"),5)):g.F(RJ,ki(h.X,V,"mainPlaylistEntity"),4);case 4:(J=RJ.X)&&B.push(J);RJ.bB(3);break;case 5:B=RJ.X;case 3:if((u=B)==null||!u.length)return RJ.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));d=g.v(W.actionMetadata,Yb6);Z=(G=d)==null?void 0:G.nextAutoRefreshIntervalSeconds;q=(r=d)==null?void 0:r.autoSync;x=[];L=z=
!0;M=!1;if(!E&&q===!1){RJ.bB(6);break}g.Qp(RJ,7);return g.F(RJ,BH6(0,!!q,!0,B),9);case 9:x=RJ.X;g.AN(RJ,8);break;case 7:U=g.CU(RJ);if(!(U instanceof Error&&U.message==="No data")){U instanceof Error&&U.message==="Empty response body"&&sU(U.message);RJ.bB(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.F(RJ,tcS(h.X,W,h.G,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.F(RJ,Nl6(H,h.X,W,h.G),8);case 8:if(!x.length||!E&&x[0].playlistId!==H)return RJ.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));case 6:if(E){y=[];T=g.e(x);for(m=T.next();!m.done;m=T.next())D=m.value,D.upToDate||q&&!D.shouldAutoSyncMetadata||!D.playlistId||(O={nextAutoRefreshIntervalSeconds:D.checkInSeconds,autoSync:q},y.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D.playlistId,"mainPlaylistEntity",0,gB,{mainPlaylistEntityActionMetadata:O})));return RJ.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,y))}x.length&&(Bd=x[0],M=!!Bd.upToDate,q&&(z=(qL=Bd.shouldAutoSyncMetadata)!=null?qL:!0,L=(Rk=Bd.shouldAutoSyncVideos)!=
null?Rk:!0,Bd.checkInSeconds&&(Z=Bd.checkInSeconds)));if(M||!z)return RJ.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));JN=[];Wd=B[0];if(!Wd.downloadState){Uv=void 0;RJ.bB(15);break}return g.F(RJ,ki(h.X,Wd.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Uv=RJ.X;case 15:return gN=Uv,lK=((W2=gN)==null?0:W2.addedTimestampMillis)?String(gN.addedTimestampMillis):void 0,g.Qp(RJ,17),g.F(RJ,oy6(h,H,lK,Z),19);case 19:JN=RJ.X;g.AN(RJ,18);break;case 17:Rf=g.CU(RJ);if(!(Rf instanceof
Error&&Rf.message==="No data for playlist")){if(Rf instanceof Error&&Rf.message==="Empty response body for playlist")sU(Rf.message);else return Fl="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",BG="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Rf instanceof g.JZ&&Rf.type==="QUOTA_EXCEEDED"&&(Fl="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",BG="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),RJ.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,Fl,BG));
RJ.bB(18);break}return g.F(RJ,Nl6(H,h.X,W,h.G),18);case 18:if(!L)return RJ.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));Tt=[];p$=new Map;if((EO=JN)==null?0:EO.length)for(C=g.e(JN),tB=C.next();!tB.done;tB=C.next())yU=tB.value,Vp=yU.offlineVideoData,iK=void 0,((iK=Vp)==null?0:iK.videoId)&&p$.set(Vp.videoId,Vp);Q=new Map;cd=[];if((Fa=Wd)==null?0:(R0=Fa.videos)==null?0:R0.length)for(v2=g.e(Wd.videos),Ov=v2.next();!Ov.done;Ov=v2.next())if(VU=Ov.value,hk=JSON.parse(g.pP(VU).entityId),
vG=hk.videoId)p$.has(vG)?(Q.set(vG,p$.get(vG)),p$.delete(vG)):cd.push(vG);a=Number(((K=W.actionMetadata)==null?void 0:K.priority)||0)+1;A=g.e(p$.entries());for(f=A.next();!f.done;f=A.next())t=f.value,GQ=g.e(t),I=GQ.next().value,k=GQ.next().value,b=I,fU=k,Tt.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",b,"mainVideoEntity",a,gB,pDU(W,fU,H)));ok=g.e(Q.entries());for(Ev=ok.next();!Ev.done;Ev=ok.next())dX=Ev.value,yp=g.e(dX),iT=yp.next().value,c3=yp.next().value,L$=iT,Nu=c3,Tt.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
L$,"mainVideoEntity",a,gB,pDU(W,Nu,H)));KU=g.e(cd);for(Q_=KU.next();!Q_.done;Q_=KU.next())ML=Q_.value,P2={playlistId:H},K$={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:P2},Tt.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",ML,"mainVideoEntity",0,gB,K$));return RJ.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,Tt))}})},Sb2=function(h,W){var c,V,H,B;
return g.P(function(E){switch(E.W){case 1:return c=uk(W),g.Qp(E,2),V=g.pP(W.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.F(E,tcS(h.X,W,h.G,(H=W.actionMetadata)==null?void 0:(B=H.offlineLoggingData)==null?void 0:B.offlineDeleteReason),5):g.F(E,Nl6(V,h.X,W,h.G),6);case 6:if(!h.uB.j("woffle_enable_main_downloads_library")){E.bB(5);break}return g.F(E,Oeu(h.X,W.entityKey),5);case 5:g.AN(E,3);break;case 2:return g.CU(E),E.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},oy6=function(h,W,c,V){var H,B,E,J,u,d,G;
return g.P(function(Z){switch(Z.W){case 1:return g.F(Z,sDS([W]),2);case 2:return H=Z.X,g.F(Z,gy2(h,H[0],c,V),3);case 3:return B=Z.X,E=B.mainPlaylistEntity,J=B.x$k,d=beX(E,(u=J)==null?void 0:u.avatar),g.Qp(Z,4),g.F(Z,zg(d),6);case 6:g.AN(Z,5);break;case 4:G=g.CU(Z),G instanceof Error&&G.message==="Failed to fetch"&&sU(G.message);case 5:return Z.return(H[0].videos)}})},gy2=function(h,W,c,V){var H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T;
return g.P(function(m){switch(m.W){case 1:H=Date.now().toString();c||(c=H);B=W.videos;E=W.playlistId;J=[];u=[];if(B)for(d=g.e(B),G=d.next();!G.done;G=d.next()){Z=G.value;r=Z.offlineVideoData;if(!r||!r.videoId)throw sU("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");q=r.videoId;x={videoId:q,playlistId:E};z={id:g.Ib(JSON.stringify(x),"mainPlaylistVideoEntity"),video:g.Ib(q,"mainVideoEntity")};J.push(z);u.push(z.id)}M={key:g.Ib(E,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:c,lastSyncedTimestampMillis:H};U={key:g.Ib(E,"mainPlaylistEntity"),playlistId:E,videos:u,title:W.title,thumbnailStyleData:DMX(W),visibility:wDu(W),downloadState:M.key};W.channel&&(y=W.channel.offlineChannelData,L=k$t(g.Ib(E,"ytMainChannelEntity"),y),U.channelOwner=L.id);((T=U)==null?0:T.entityMetadata)?(U.entityMetadata.offlineLastModifiedTimestampSeconds=W.lastModifiedTimestamp,V&&(U.entityMetadata.nextAutoRefreshIntervalSeconds=String(V))):U&&(U.entityMetadata={nextAutoRefreshIntervalSeconds:V?
String(V):void 0,offlineLastModifiedTimestampSeconds:W.lastModifiedTimestamp});g.Qp(m,2);return g.F(m,Di(h.X,{mode:"readwrite",nJ:!0},function(D){var O=Yi(D,U,"mainPlaylistEntity"),Bd=Yi(D,M,"mainPlaylistDownloadStateEntity");O=[O,Bd];Bd=g.e(J);for(var qL=Bd.next();!qL.done;qL=Bd.next())O.push(Yi(D,qL.value,"mainPlaylistVideoEntity"));L&&O.push(Yi(D,L,"ytMainChannelEntity"));return g.x4.all(O)}),4);
case 4:g.AN(m,3);break;case 2:throw g.CU(m),sU("PES failure for playlist"),Error("PES failure for playlist");case 3:return m.return({mainPlaylistEntity:U,x$k:L,rZI:J})}})},k$t=function(h,W){return{id:h,
channelId:W.channelId,title:W.title,avatar:W.thumbnail}},DMX=function(h){var W=[],c=h.videos;
c&&c.length>0&&W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:c[0].offlineVideoData.thumbnail}}});if((h=h.additionalMetadadatas)&&h.length>0)for(h=g.e(h),c=h.next();!c.done;c=h.next()){var V=c.value.offlineBundleItemPlaylistData,H=void 0;c=(H=V)==null?void 0:H.style;H=void 0;V={collageThumbnail:{coverThumbnail:(H=V)==null?void 0:H.coverThumbnail}};switch(c){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:V});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:V})}}return W},wDu=function(h){switch(h.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},pDU=function(h,W,c){W={offlineVideoData:W,
playlistId:c};if(h=g.v(h.actionMetadata,Yb6))W.maximumDownloadQuality=h.maximumDownloadQuality;return{mainVideoEntityActionMetadata:W}},hHU=function(h,W,c){this.X=h;
this.uB=W;this.G=c},Vnu=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x;
return g.P(function(z){switch(z.W){case 1:return c=uk(W),V=g.pP(W.entityKey),H=V.entityId,B=g.v(W.actionMetadata,Dm),J=!((E=B)==null?0:E.playlistId),g.Qp(z,2),g.F(z,WPf(h,H,void 0,(u=B)==null?void 0:u.offlineVideoData,J),4);case 4:g.AN(z,3);break;case 2:return d=g.CU(z),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.JZ&&d.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
z.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,G,Z));case 3:r=1;r=Number(((q=W.actionMetadata)==null?void 0:q.priority)||0)+1;var L=(L=g.v(W.actionMetadata,Dm))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;x=PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",r,ct2,L);return z.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,[x]))}})},$Uc=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U;
return g.P(function(y){switch(y.W){case 1:return c=uk(W),V=g.pP(W.entityKey),H=V.entityId,g.F(y,ki(h.X,W.entityKey,"mainVideoEntity"),2);case 2:B=y.X;if(!B){E=void 0;y.bB(3);break}return g.F(y,ki(h.X,B.downloadState,"mainVideoDownloadStateEntity"),4);case 4:E=y.X;case 3:J=E;if(!B||!J)return y.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.Qp(y,5);return g.F(y,WPf(h,H,J.addedTimestampMillis,(d=g.v(W.actionMetadata,Dm))==null?void 0:d.offlineVideoData),7);case 7:G=1;G=Number(((Z=
W.actionMetadata)==null?void 0:Z.priority)||0)+1;u=PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",G,ct2);g.AN(y,6);break;case 5:r=g.CU(y);if(!(r instanceof Error&&r.message==="No data")){if(r instanceof Error&&r.message==="Empty response body")sU(r.message);else return q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.JZ&&r.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),y.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,q,x));y.bB(6);break}return g.F(y,ik(h.X,H),9);case 9:z=y.X;L=g.v(W.actionMetadata,Dm);if(U=(M=L)==null?void 0:M.playlistId)z.playlistId=U;z.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.F(y,QF(H,h.X,W,h.G,z),6);case 6:return y.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,u?[u]:void 0))}})},sWt=function(h,W){var c,V,H,B,E,J,u,d,G,Z;
return g.P(function(r){switch(r.W){case 1:return c=uk(W),g.Qp(r,2),V=g.pP(W.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.F(r,tcS(h.X,W,h.G,(G=W.actionMetadata)==null?void 0:(Z=G.offlineLoggingData)==null?void 0:Z.offlineDeleteReason),5):g.F(r,ik(h.X,V),6);case 6:H=r.X;B=g.v(W.actionMetadata,Dm);if(J=(E=B)==null?void 0:E.playlistId)H.playlistId=J;H.offlineDeleteReason=(u=W.actionMetadata)==null?void 0:(d=u.offlineLoggingData)==null?void 0:d.offlineDeleteReason;return g.F(r,QF(V,h.X,W,h.G,H),7);
case 7:if(!h.uB.j("woffle_enable_main_downloads_library")){r.bB(5);break}return g.F(r,Oeu(h.X,W.entityKey),5);case 5:g.AN(r,3);break;case 2:return g.CU(r),r.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},WPf=function(h,W,c,V,H){var B,E,J,u,d,G;
return g.P(function(Z){switch(Z.W){case 1:if(B=V){Z.bB(2);break}return g.F(Z,$fS([W]),3);case 3:E=Z.X,B=E[0];case 2:return g.F(Z,Hut(h,B,c,H),4);case 4:J=Z.X;u=J.mainVideoEntity;d=J.channelEntity;g.Qp(Z,5);var r=lk(u.thumbnail),q=lk(d.avatar);return g.F(Z,zg(r.concat(q)),7);case 7:g.AN(Z,0);break;case 5:G=g.CU(Z),G instanceof Error&&G.message==="Failed to fetch"&&sU(G.message),g.zQ(Z)}})},Hut=function(h,W,c,V){var H,B,E,J,u,d,G,Z,r,q,x,z,L;
return g.P(function(M){switch(M.W){case 1:c||(c=Date.now().toString());B=(H=W.channel)==null?void 0:H.offlineChannelData;E={id:g.Ib(W.videoId,"ytMainChannelEntity"),channelId:B.channelId,title:B.title,avatar:B.thumbnail};J={key:g.Ib(W.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Ib(W.videoId,"playbackData"),addedTimestampMillis:c,videoDownloadContextEntity:g.Ib(W.videoId,"videoDownloadContextEntity")};u={key:g.Ib(W.videoId,"videoPlaybackPositionEntity"),videoId:W.videoId,lastPlaybackPositionSeconds:"0"};
h.uB.j("html5_offline_playback_position_sync")&&(d={playbackPosition:u.key});G=g.Ib(W.videoId,"mainVideoEntity");Z={key:G,videoId:W.videoId,title:W.title,thumbnail:W.thumbnail,localizedStrings:{viewCount:W.shortViewCountText},userState:d,lengthSeconds:W.lengthSeconds?Number(W.lengthSeconds):void 0,publishedTimestampMillis:W.publishedTimestamp?(Number(W.publishedTimestamp)*1E3).toString():void 0,formattedDescription:W.description,owner:E.id,downloadState:J.key};if(!h.uB.j("woffle_enable_main_downloads_library")||
!V){M.bB(2);break}return g.F(M,ID6(h.X,[G]),3);case 3:if(x=M.X)r=x.mainDownloadsLibraryEntity,q=x.mainDownloadsListEntity;case 2:return L=CdU,z={key:g.Ib(W.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Cx(J,L,z),g.F(M,Di(h.X,{mode:"readwrite",nJ:!0},function(U){var y=Yi(U,E,"ytMainChannelEntity"),T=Yi(U,J,"mainVideoDownloadStateEntity"),m=Yi(U,Z,"mainVideoEntity");y=[y,T,m];h.uB.j("html5_offline_playback_position_sync")&&(T=Yi(U,u,"videoPlaybackPositionEntity"),
y.push(T));r&&(T=Yi(U,r,"mainDownloadsLibraryEntity"),y.push(T));q&&(T=Yi(U,q,"mainDownloadsListEntity"),y.push(T));z&&(U=Yi(U,z,"downloadStatusEntity"),y.push(U));return g.x4.all(y)}),4);
case 4:return M.return({mainVideoEntity:Z,channelEntity:E})}})},BOX=function(h,W,c){this.X=h;
this.uB=W;this.G=c},RHS=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd;
return g.P(function(Uv){switch(Uv.W){case 1:return c=uk(W),V=[],g.F(Uv,td.getInstance(),2);case 2:H=Uv.X;if(!H){Uv.bB(3);break}return g.F(Uv,H.get("sdois"),4);case 4:return B=Uv.X,g.F(Uv,(J=H)==null?void 0:J.get("lmqf"),5);case 5:E=Uv.X;case 3:g.Qp(Uv,6);if(B===void 0)throw Error("prefStorage or opt-in state is undefined");u=[];if(B){Uv.bB(8);break}return g.F(Uv,p9K(h.X),9);case 9:u=Uv.X,u.reverse();case 8:if(!u.length){Uv.bB(10);break}d=g.e(u);G=d.next();case 11:if(G.done){Uv.bB(10);break}Z=G.value;
if(!Z){Uv.bB(12);break}r=g.pP(Z).entityId;return g.F(Uv,ik(h.X,r),14);case 14:return q=Uv.X,q.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.F(Uv,QF(r,h.X,{entityKey:Z,actionType:W.actionType},h.G,q),12);case 12:G=d.next();Uv.bB(11);break;case 10:return g.F(Uv,R5U(B,(x=E)!=null?x:"SD"),16);case 16:return z=Uv.X,g.F(Uv,vQf(z),17);case 17:L=oQ6(z);if(!h.uB.j("woffle_enable_main_downloads_library")){Uv.bB(18);break}if(B){Uv.bB(19);break}return g.F(Uv,Oeu(h.X,g.vC),19);case 19:return g.F(Uv,
YEU(h.X,[g.vC]),18);case 18:if((M=L)==null?0:M.length)for(U=g.e(L),y=U.next();!y.done;y=U.next())if(m=T=y.value,D=m.actionType,O=m.entityKey,Bd=m.actionMetadata,D&&O&&Bd&&!g.v(Bd,EZU)){D==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Bd.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(qL=g.v(T.actionMetadata,Dm))qL.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",T.actionMetadata=Object.assign({},T.actionMetadata,{mainVideoEntityActionMetadata:qL});V.push(T)}g.AN(Uv,
7);break;case 6:return Rk=g.CU(Uv),JN="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Wd="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Rk instanceof g.JZ&&Rk.type==="QUOTA_EXCEEDED"&&(JN="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Wd="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Uv.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,JN,Wd));case 7:return Uv.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,V))}})},JtU=function(){OU.apply(this,
arguments);
this.T="mainVideoEntity"},u_$=function(h,W,c){W=W===void 0?43200:W;
c=c===void 0?!0:c;var V=V===void 0?!1:V;var H,B,E;return g.P(function(J){switch(J.W){case 1:if(!h.N.zj())return J.return([]);H=[];g.Qp(J,2);return g.F(J,BH6(W,c,V),4);case 4:H=J.X;g.AN(J,3);break;case 2:B=g.CU(J),B instanceof Error&&B.message==="No data"||B instanceof Error&&B.message==="Empty response body"&&sU(B.message);case 3:return E=tQS(h,H,c,"mainPlaylistEntity"),J.return(E)}})},dUX=function(h,W,c,V){V=V===void 0?!1:V;
var H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U;return g.P(function(y){switch(y.W){case 1:return H=[],g.F(y,E$c(),2);case 2:return(B=y.X)||V?g.F(y,Jj6(W,c),3):y.return([]);case 3:E=y.X;if((J=E)==null||!J.length)return y.return([]);u={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};d=g.e(E);G=d.next();case 4:if(G.done){y.bB(6);break}r=Z=G.value;q=r.actionType;x=r.entityKey;z=r.actionMetadata;if(!(q&&x&&z)||g.v(z,EZU)){y.bB(5);break}q==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(z.offlineLoggingData=
u);L=g.pP(x);M=L.entityId;return g.F(y,Sh(h,[M],"mainVideoEntity",q,z),8);case 8:U=y.X,H=H.concat(U);case 5:G=d.next();y.bB(4);break;case 6:return y.return(H)}})},G7l=function(h,W){this.X=h;
this.G=W},rtl=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M;
return g.P(function(U){switch(U.W){case 1:return c=uk(W),V=g.pP(W.entityKey),H=V.entityId,B=[],g.Qp(U,2),g.F(U,Zu$(h,H),4);case 4:B=U.X;if((E=B)==null||!E.length){U.bB(5);break}return g.F(U,kTt(h.X,W.entityKey),5);case 5:g.AN(U,3);break;case 2:return J=g.CU(U),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.JZ&&J.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
U.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,u,d));case 3:return G=[],g.F(U,Mcf(h.X,"musicTrack",B),7);case 7:B=U.X;if(B.length)for(Z=g.e(B),r=Z.next();!r.done;r=Z.next())if(q=r.value,x=q.offlineVideoData,z=void 0,(z=x)==null?0:z.videoId)L=void 0,M=Number(((L=W.actionMetadata)==null?void 0:L.priority)||0)+1,G.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x.videoId,"musicTrack",M,wB,Cd(W,x,H)));return U.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,G))}})},
q_6=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf,Fl,BG,Tt,p$,EO,C,tB,yU,Vp,iK,Q,cd,Fa,R0,v2,Ov,VU,hk,vG,K,a,A,f,t,GQ,I,k;
return g.P(function(b){switch(b.W){case 1:return c=uk(W),V=W.entityKey,H=g.pP(V).entityId,B=[],E=!1,H==="!*$_ALL_ENTITIES_!*$"?(E=!0,g.F(b,hf(h.X,"musicAlbumRelease"),5)):g.F(b,ki(h.X,V,"musicAlbumRelease"),4);case 4:(J=b.X)&&B.push(J);b.bB(3);break;case 5:B=b.X;case 3:if((u=B)==null||!u.length)return b.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));if(E){d=[];G=g.e(B);for(Z=G.next();!Z.done;Z=G.next())r=Z.value,q=g.pP(r.id).entityId,d.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
q,"musicAlbumRelease",0,wB));return b.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,d))}x=[];z=B[0];L=void 0;if(!z.downloadMetadata){b.bB(6);break}return g.F(b,ki(h.X,z.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:M=b.X,L=Number((y=(U=M)==null?void 0:U.addedTimestampMillis)!=null?y:"0")/1E3;case 6:return g.Qp(b,8),g.F(b,Zu$(h,H,(T=L)==null?void 0:T.toString()),10);case 10:x=b.X;g.AN(b,9);break;case 8:m=g.CU(b);if(!(m instanceof Error&&m.message==="No data")){if(m instanceof
Error&&m.message==="Empty response body")sU(m.message);else return D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.JZ&&m.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),b.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,D,O));b.bB(9);break}return g.F(b,Af(H,"musicAlbumRelease",h.X,W,h.G),9);case 9:Bd=[];qL=new Map;
if((Rk=x)==null?0:Rk.length)for(JN=g.e(x),Wd=JN.next();!Wd.done;Wd=JN.next())Uv=Wd.value,gN=Uv.offlineVideoData,W2=void 0,((W2=gN)==null?0:W2.videoId)&&qL.set(gN.videoId,gN);lK=new Map;Rf=[];if((Fl=z)==null?0:(BG=Fl.tracks)==null?0:BG.length)for(Tt=g.e(z.tracks),p$=Tt.next();!p$.done;p$=Tt.next())if(EO=p$.value,C=g.pP(EO).entityId)qL.has(C)?(lK.set(C,qL.get(C)),qL.delete(C)):Rf.push(C);yU=Number(((tB=W.actionMetadata)==null?void 0:tB.priority)||0)+1;Vp=g.e(qL.entries());for(iK=Vp.next();!iK.done;iK=
Vp.next())Q=iK.value,cd=g.e(Q),Fa=cd.next().value,R0=cd.next().value,v2=Fa,Ov=R0,Bd.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v2,"musicTrack",yU,wB,Cd(W,Ov)));VU=g.e(lK.entries());for(hk=VU.next();!hk.done;hk=VU.next())vG=hk.value,K=g.e(vG),a=K.next().value,A=K.next().value,f=a,t=A,Bd.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",f,"musicTrack",yU,wB,Cd(W,t)));GQ=g.e(Rf);for(I=GQ.next();!I.done;I=GQ.next())k=I.value,Bd.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",k,"musicTrack",
0,wB));return b.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,Bd))}})},xUU=function(h,W){var c,V;
return g.P(function(H){switch(H.W){case 1:return c=uk(W),g.Qp(H,2),V=g.pP(W.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.F(H,UU(h.X,W,h.G),5):g.F(H,Af(V,"musicAlbumRelease",h.X,W,h.G),6);case 6:return g.F(H,h5U(h.X,W.entityKey),5);case 5:g.AN(H,3);break;case 2:return g.CU(H),H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},Zu$=function(h,W,c){var V,H,B;
return g.P(function(E){switch(E.W){case 1:return g.F(E,sDS([W]),2);case 2:return V=E.X,g.F(E,l36(h,V[0],c),3);case 3:return H=E.X,B=lk(H.thumbnailDetails),g.F(E,zg(B),4);case 4:return E.return(V[0].videos)}})},l36=function(h,W,c){var V,H,B,E,J,u,d,G,Z,r,q,x,z,L;
return g.P(function(M){if(M.W==1){V=W.additionalMetadadatas;H=void 0;if(V&&V.length>0)for(B=g.e(V),E=B.next();!E.done;E=B.next())if(J=E.value,J.offlineMusicPlaylistData){H=J.offlineMusicPlaylistData;break}u=W.playlistId;d=WsU(W);G=d.DK;Z=d.zm;r=c?(Number(c)*1E3).toString():Date.now().toString();q=W.lastModifiedTimestamp?(Number(W.lastModifiedTimestamp)*1E3).toString():"0";x={id:g.Ib(u,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:Z,lastModifiedTimestampMillis:q,addedTimestampMillis:r,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};z={id:g.Ib(u,"musicAlbumRelease"),title:W.title,audioPlaylistId:u,trackCount:W.totalVideoCount,tracks:G,downloadMetadata:x.id};H&&(z.thumbnailDetails=(L=H.albumHqThumbnail)!=null?L:H.albumArtistThumbnail,z.artistDisplayName=H.albumArtistDisplayName,z.releaseDate=H.albumReleaseDate,z.contentRating={explicitType:H.albumReleaseExplicitType},z.releaseType=H.albumReleaseType);return g.F(M,Di(h.X,{mode:"readwrite",nJ:!0},function(U){var y=Yi(U,z,"musicAlbumRelease");
U=Yi(U,x,"musicAlbumReleaseDownloadMetadataEntity");return g.x4.all([y,U])}),2)}return M.return(z)})},nZ6=function(h,W){this.X=h;
this.G=W},a3I=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M;
return g.P(function(U){switch(U.W){case 1:return c=uk(W),V=g.pP(W.entityKey),H=V.entityId,B=[],g.Qp(U,2),g.F(U,jWU(h,H),4);case 4:B=U.X;if((E=B)==null||!E.length){U.bB(5);break}return g.F(U,kTt(h.X,W.entityKey),5);case 5:g.AN(U,3);break;case 2:return J=g.CU(U),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.JZ&&J.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
U.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,u,d));case 3:return G=[],g.F(U,Mcf(h.X,"musicTrack",B),7);case 7:B=U.X;if(B.length)for(Z=g.e(B),r=Z.next();!r.done;r=Z.next())if(q=r.value,x=q.offlineVideoData,z=void 0,(z=x)==null?0:z.videoId)L=void 0,M=Number(((L=W.actionMetadata)==null?void 0:L.priority)||0)+1,G.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x.videoId,"musicTrack",M,km,Cd(W,x,H)));return U.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,G))}})},
eH6=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf,Fl,BG,Tt,p$,EO,C,tB,yU,Vp,iK,Q,cd,Fa,R0,v2,Ov,VU,hk,vG,K,a,A,f,t,GQ,I,k,b,fU,ok,Ev,dX,yp,iT,c3,L$,Nu,KU,Q_;
return g.P(function(ML){switch(ML.W){case 1:return c=uk(W),V=W.entityKey,H=g.pP(V).entityId,B=[],E=!1,H==="!*$_ALL_ENTITIES_!*$"?(E=!0,g.F(ML,hf(h.X,"musicPlaylist"),5)):g.F(ML,ki(h.X,V,"musicPlaylist"),4);case 4:(J=ML.X)&&B.push(J);ML.bB(3);break;case 5:B=ML.X;case 3:if((u=B)==null||!u.length)return ML.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));d=g.v(W.actionMetadata,cjK);Z=(G=d)==null?void 0:G.autoSync;r=[];x=q=!0;z=!1;L=void 0;if(!E&&Z===!1){ML.bB(6);break}g.Qp(ML,7);return g.F(ML,
ud2(0,!!Z,!0,B),9);case 9:r=ML.X;g.AN(ML,8);break;case 7:M=g.CU(ML);if(!(M instanceof Error&&M.message==="No data")){M instanceof Error&&M.message==="Empty response body"&&sU(M.message);ML.bB(8);break}return H==="!*$_ALL_ENTITIES_!*$"?g.F(ML,UU(h.X,W,h.G),8):g.F(ML,Af(H,"musicPlaylist",h.X,W,h.G),8);case 8:if(!r.length||!E&&r[0].playlistId!==H)return ML.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));case 6:if(E){U=[];y=g.e(r);for(T=y.next();!T.done;T=y.next())m=T.value,m.upToDate||
Z&&!m.shouldAutoSyncMetadata||!m.playlistId||(D={autoSync:Z},U.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",m.playlistId,"musicPlaylist",0,km,{musicPlaylistEntityActionMetadata:D})));return ML.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,U))}r.length&&(O=r[0],z=!!O.upToDate,Z&&(q=(Bd=O.shouldAutoSyncMetadata)!=null?Bd:!0,x=(qL=O.shouldAutoSyncVideos)!=null?qL:!0,O.checkInSeconds&&(L=O.checkInSeconds)));if(z||!q)return ML.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));Rk=[];JN=B[0];Wd=void 0;if(!JN.downloadMetadata){ML.bB(15);break}return g.F(ML,ki(h.X,JN.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Uv=ML.X,Wd=Number((W2=(gN=Uv)==null?void 0:gN.addedTimestampMillis)!=null?W2:"0")/1E3;case 15:return g.Qp(ML,17),g.F(ML,jWU(h,H,(lK=Wd)==null?void 0:lK.toString(),L),19);case 19:Rk=ML.X;g.AN(ML,18);break;case 17:Rf=g.CU(ML);if(!(Rf instanceof Error&&Rf.message==="No data")){if(Rf instanceof Error&&Rf.message==="Empty response body")sU(Rf.message);
else return Fl="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",BG="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Rf instanceof g.JZ&&Rf.type==="QUOTA_EXCEEDED"&&(Fl="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",BG="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ML.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,Fl,BG));ML.bB(18);break}return g.F(ML,Af(H,"musicPlaylist",h.X,W,h.G),18);case 18:if(!x)return ML.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));Tt=[];p$=new Map;if((EO=Rk)==null?0:EO.length)for(C=g.e(Rk),tB=C.next();!tB.done;tB=C.next())yU=tB.value,Vp=yU.offlineVideoData,iK=void 0,((iK=Vp)==null?0:iK.videoId)&&p$.set(Vp.videoId,Vp);Q=new Map;cd=[];if((Fa=JN)==null?0:(R0=Fa.tracks)==null?0:R0.length)for(v2=g.e(JN.tracks),Ov=v2.next();!Ov.done;Ov=v2.next())if(VU=Ov.value,hk=g.pP(VU).entityId)p$.has(hk)?(Q.set(hk,p$.get(hk)),p$.delete(hk)):cd.push(hk);K=Number(((vG=W.actionMetadata)==null?void 0:vG.priority)||0)+1;a=g.e(p$.entries());for(A=
a.next();!A.done;A=a.next())f=A.value,t=g.e(f),GQ=t.next().value,I=t.next().value,k=GQ,b=I,Tt.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"musicTrack",K,km,Cd(W,b)));fU=g.e(Q.entries());for(ok=fU.next();!ok.done;ok=fU.next())Ev=ok.value,dX=g.e(Ev),yp=dX.next().value,iT=dX.next().value,c3=yp,L$=iT,Tt.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c3,"musicTrack",K,km,Cd(W,L$)));Nu=g.e(cd);for(KU=Nu.next();!KU.done;KU=Nu.next())Q_=KU.value,Tt.push(PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Q_,"musicTrack",0,km));return ML.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,Tt))}})},zHS=function(h,W){var c,V;
return g.P(function(H){switch(H.W){case 1:return c=uk(W),g.Qp(H,2),V=g.pP(W.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.F(H,UU(h.X,W,h.G),5):g.F(H,Af(V,"musicPlaylist",h.X,W,h.G),6);case 6:return g.F(H,h5U(h.X,W.entityKey),5);case 5:g.AN(H,3);break;case 2:return g.CU(H),H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},jWU=function(h,W,c,V){var H,B,E;
return g.P(function(J){switch(J.W){case 1:return g.F(J,sDS([W]),2);case 2:return H=J.X,g.F(J,QWc(h,H[0],c,V),3);case 3:return B=J.X,E=lk(B.thumbnailDetails),g.F(J,zg(E),4);case 4:return J.return(H[0].videos)}})},QWc=function(h,W,c,V){var H,B,E,J,u,d,G,Z,r;
return g.P(function(q){return q.W==1?(H=W.playlistId,B=WsU(W),E=B.DK,J=B.zm,u=c?(Number(c)*1E3).toString():Date.now().toString(),d=W.lastModifiedTimestamp?(Number(W.lastModifiedTimestamp)*1E3).toString():"0",G={id:g.Ib(H,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:J,lastModifiedTimestampMillis:d,addedTimestampMillis:u,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},Z={id:g.Ib(H,"musicPlaylist"),title:W.title,playlistId:H,thumbnailDetails:W.thumbnail,visibility:LP2(W),trackCount:W.totalVideoCount,
tracks:E,downloadMetadata:G.id},V&&(((r=Z)==null?0:r.entityMetadata)?Z.entityMetadata.nextAutoRefreshIntervalSeconds=String(V):Z&&(Z.entityMetadata={nextAutoRefreshIntervalSeconds:String(V)})),g.F(q,Di(h.X,{mode:"readwrite",nJ:!0},function(x){var z=Yi(x,Z,"musicPlaylist");x=Yi(x,G,"musicPlaylistDownloadMetadataEntity");return g.x4.all([z,x])}),2)):q.return(Z)})},LP2=function(h){switch(h.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},iut=function(h,W){this.X=h;
this.G=W},C$I=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x;
return g.P(function(z){switch(z.W){case 1:return c=uk(W),V=g.pP(W.entityKey),H=V.entityId,B=g.v(W.actionMetadata,KPI),g.Qp(z,2),g.F(z,Atc(h,H,void 0,(E=B)==null?void 0:E.track,(J=B)==null?void 0:J.albumRelease),4);case 4:if((u=B)==null?0:u.playlistId){z.bB(5);break}return g.F(z,kTt(h.X,W.entityKey),5);case 5:g.AN(z,3);break;case 2:return d=g.CU(z),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.JZ&&d.type==="QUOTA_EXCEEDED"&&
(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),z.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,G,Z));case 3:q=Number(((r=W.actionMetadata)==null?void 0:r.priority)||0)+1;var L=(L=g.v(W.actionMetadata,KPI))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;x=PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H,"playbackData",q,UUt,L);return z.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c,[x]))}})},Mn6=function(h,W){var c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L;
return g.P(function(M){switch(M.W){case 1:return c=uk(W),V=g.pP(W.entityKey),H=V.entityId,g.F(M,ki(h.X,W.entityKey,"musicTrack"),2);case 2:B=M.X;if(!B){E=void 0;M.bB(3);break}return g.F(M,ki(h.X,B.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:E=M.X;case 3:J=E;if(!B||!J)return M.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));d=g.v(W.actionMetadata,KPI);g.Qp(M,5);return g.F(M,Atc(h,H,J.addedTimestampMillis,(G=d)==null?void 0:G.track,(Z=d)==null?void 0:Z.albumRelease),
7);case 7:q=Number(((r=W.actionMetadata)==null?void 0:r.priority)||0)+1;u=PZ("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H,"playbackData",q,UUt);g.AN(M,6);break;case 5:x=g.CU(M);if(!(x instanceof Error&&x.message==="No data")){if(x instanceof Error&&x.message==="Empty response body")sU(x.message);else return z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.JZ&&x.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),M.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,z,L));M.bB(6);break}return g.F(M,Kd(H,h.X,W,h.G),6);case 6:return M.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,u?[u]:void 0))}})},FP2=function(h,W){var c,V;
return g.P(function(H){switch(H.W){case 1:return c=uk(W),g.Qp(H,2),V=g.pP(W.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.F(H,UU(h.X,W,h.G),5):g.F(H,Kd(V,h.X,W,h.G),6);case 6:return g.F(H,h5U(h.X,W.entityKey),5);case 5:g.AN(H,3);break;case 2:return g.CU(H),H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new fd("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},Atc=function(h,W,c,V,H){var B,E,J,u,d,G;
return g.P(function(Z){switch(Z.W){case 1:if(B=V){Z.bB(2);break}return g.F(Z,$fS([W]),3);case 3:E=Z.X,J=E[0],B=w9U(J);case 2:return g.F(Z,yt6(h,B,W,H,c),4);case 4:u=Z.X;d=u.musicTrackEntity;G=u.B8;var r=lk(d.thumbnailDetails),q=[];G&&(q=lk(G.thumbnailDetails));return g.F(Z,zg(r.concat(q)),0)}})},yt6=function(h,W,c,V,H){var B;
return g.P(function(E){return E.W==1?(H||(H=Date.now().toString()),B={id:g.Ib(c,"musicTrackDownloadMetadataEntity"),playbackData:g.Ib(c,"playbackData"),addedTimestampMillis:H,videoDownloadContextEntity:g.Ib(c,"videoDownloadContextEntity")},V&&(W.albumRelease=V.id),g.F(E,Di(h.X,{mode:"readwrite",nJ:!0},function(J){var u=[],d=Yi(J,B,"musicTrackDownloadMetadataEntity");u.push(d);d=Yi(J,W,"musicTrack");u.push(d);V&&(J=Yi(J,V,"musicAlbumRelease"),u.push(J));return g.x4.all(u)}),2)):E.W!=3?g.F(E,rB(c,"musicTrackDownloadMetadataEntity",
h.X,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):E.return({musicTrackEntity:W,
B8:V})})},hi=function(){OU.apply(this,arguments);
this.T="musicTrack"},P$f=function(h,W,c){W=W===void 0?43200:W;
c=c===void 0?!0:c;var V=V===void 0?!1:V;var H,B;return g.P(function(E){switch(E.W){case 1:if(!h.N.zj())return E.return([]);H=[];g.Qp(E,2);return g.F(E,ud2(W,c,V),4);case 4:H=E.X;g.AN(E,3);break;case 2:g.CU(E);case 3:return B=tQS(h,H,c,"musicPlaylist"),E.return(B)}})},f3I=function(){g.K3.apply(this,arguments);
var h=this;this.events=new g.lX(this);this.uB=this.player.B();this.uX={vqM:function(){return h.X},
vQ:function(){return h.vQ()},
uM:function(W){return h.uM(W)}}},buU=function(h){var W;
h=g.v((W=h.getWatchNextResponse())==null?void 0:W.currentVideoEndpoint,g.nC);if(h==null?0:h.playlistId)var c=h.playlistId;return c},TOI=function(h,W){var c,V,H,B;
return g.P(function(E){if(E.W==1){c=W.clientPlaybackNonce;V={cpn:c,offlineSourceVisualElement:g.GE(W.Nn||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};W.W&&(V.videoFmt=Number(W.W.itag));W.Y&&(V.audioFmt=Number(W.Y.itag));if((H=buU(W))&&W.videoId){var J=W.videoId;J=H!=="PPSV"?Promise.resolve(!1):h.X.Qc(J);E=g.F(E,J,3)}else E=E.bB(2);return E}E.W!=2&&(B=E.X)&&(V.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");h.W=c;g.V5("offlinePlaybackStarted",V);g.zQ(E)})};
g.t7.prototype.nC=g.$5(45,function(h){return this.app.nC(h)});
g.jw.prototype.nC=g.$5(44,function(h){return g.p4N(this,9,h)});
g.n(N5,Tl);g.Hd.Object.defineProperties(N5.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.X.entityMetadata},
set:function(h){this.X.entityMetadata=h}}});
g.n(iR2,N5);iR2.prototype.W=function(){return[]};
g.n(KL2,N5);KL2.prototype.W=function(){return[]};
g.n(AbU,N5);AbU.prototype.W=function(){return[]};
g.n(UY6,N5);UY6.prototype.W=function(){return[]};
g.n(COU,N5);COU.prototype.W=function(){return[]};
g.n(Mel,N5);Mel.prototype.W=function(){var h=[];this.X.alternateChannel&&h.push(this.X.alternateChannel);this.X.alternateChannelList&&h.push.apply(h,g.rN(this.X.alternateChannelList));this.X.oneofChannelEntity&&h.push(this.X.oneofChannelEntity);return[].concat(g.rN(new Set(h)))};
g.n(FLl,N5);FLl.prototype.W=function(){var h=[];this.X.entryCollection&&h.push(this.X.entryCollection);return[].concat(g.rN(new Set(h)))};
g.n(ybI,Tl);ybI.prototype.W=function(){var h=[];this.X.video&&h.push(this.X.video);return[].concat(g.rN(new Set(h)))};
g.n(PO$,N5);PO$.prototype.W=function(){var h=[];this.X.parentPlaylist&&h.push(this.X.parentPlaylist);if(this.X.entries)for(var W=g.e(this.X.entries),c=W.next();!c.done;c=W.next())h.push.apply(h,g.rN((new ybI(c.value)).W()));return[].concat(g.rN(new Set(h)))};
g.n(fkI,N5);fkI.prototype.W=function(){var h=[];this.X.descriptionEntity&&h.push(this.X.descriptionEntity);this.X.creators&&h.push.apply(h,g.rN(this.X.creators));this.X.theBiggestFan&&h.push(this.X.theBiggestFan);return[].concat(g.rN(new Set(h)))};
g.n(bRI,N5);bRI.prototype.W=function(){return[]};
g.n(Tx$,N5);Tx$.prototype.W=function(){return[]};
g.n(NxK,N5);NxK.prototype.W=function(){return[]};
g.n(XUU,N5);XUU.prototype.W=function(){return[]};
g.n(te2,N5);te2.prototype.W=function(){return[]};
g.n(vf$,N5);vf$.prototype.W=function(){return[]};
g.n(mYI,N5);mYI.prototype.W=function(){return[]};
g.n(ofU,N5);ofU.prototype.W=function(){return[]};
g.n(pUU,N5);pUU.prototype.W=function(){return[]};
g.n(Ik6,N5);Ik6.prototype.W=function(){var h=[];this.X.downloadsList&&h.push(this.X.downloadsList);this.X.smartDownloadsList&&h.push(this.X.smartDownloadsList);this.X.recommendedDownloadsList&&h.push(this.X.recommendedDownloadsList);this.X.refresh&&h.push(this.X.refresh);return[].concat(g.rN(new Set(h)))};
g.n(YTl,Tl);YTl.prototype.W=function(){var h=[];this.X.video&&h.push(this.X.video);this.X.playlist&&h.push(this.X.playlist);this.X.videoItem&&h.push(this.X.videoItem);this.X.playlistItem&&h.push(this.X.playlistItem);return[].concat(g.rN(new Set(h)))};
g.n(ORl,N5);ORl.prototype.W=function(){var h=[];this.X.refresh&&h.push(this.X.refresh);if(this.X.downloads)for(var W=g.e(this.X.downloads),c=W.next();!c.done;c=W.next())h.push.apply(h,g.rN((new YTl(c.value)).W()));return[].concat(g.rN(new Set(h)))};
g.n(STX,N5);STX.prototype.W=function(){var h=[];this.X.localImageEntities&&h.push.apply(h,g.rN(this.X.localImageEntities));return[].concat(g.rN(new Set(h)))};
g.n(gf2,N5);gf2.prototype.W=function(){var h=[];this.X.playbackData&&h.push(this.X.playbackData);this.X.localImageEntities&&h.push.apply(h,g.rN(this.X.localImageEntities));this.X.videoDownloadContextEntity&&h.push(this.X.videoDownloadContextEntity);return[].concat(g.rN(new Set(h)))};
g.n(DYX,N5);DYX.prototype.W=function(){return[]};
g.n(wUc,N5);wUc.prototype.W=function(){var h=[];this.X.fakeChildren&&h.push.apply(h,g.rN(this.X.fakeChildren));return[].concat(g.rN(new Set(h)))};
g.n(kuK,N5);kuK.prototype.W=function(){var h=[];this.X.video&&h.push(this.X.video);this.X.playbackData&&h.push(this.X.playbackData);this.X.offlineVideoPolicy&&h.push(this.X.offlineVideoPolicy);return[].concat(g.rN(new Set(h)))};
g.n(hht,N5);hht.prototype.W=function(){return[]};
g.n(WmU,N5);WmU.prototype.W=function(){var h=[];this.X.channelOwner&&h.push(this.X.channelOwner);this.X.videos&&h.push.apply(h,g.rN(this.X.videos));this.X.collaboratorChannels&&h.push.apply(h,g.rN(this.X.collaboratorChannels));this.X.downloadState&&h.push(this.X.downloadState);this.X.refresh&&h.push(this.X.refresh);return[].concat(g.rN(new Set(h)))};
g.n(cHU,N5);cHU.prototype.W=function(){var h=[];this.X.video&&h.push(this.X.video);this.X.channelContributor&&h.push(this.X.channelContributor);return[].concat(g.rN(new Set(h)))};
g.n(Vxt,Tl);Vxt.prototype.W=function(){var h=[];this.X.localImageEntities&&h.push.apply(h,g.rN(this.X.localImageEntities));this.X.videoDownloadContextEntity&&h.push(this.X.videoDownloadContextEntity);return[].concat(g.rN(new Set(h)))};
g.n($$6,Tl);$$6.prototype.W=function(){var h=[];this.X.recommendedVideoMetadata&&h.push.apply(h,g.rN((new Vxt(this.X.recommendedVideoMetadata)).W()));return[].concat(g.rN(new Set(h)))};
g.n(sH6,Tl);sH6.prototype.W=function(){var h=[];this.X.playbackPosition&&h.push(this.X.playbackPosition);return[].concat(g.rN(new Set(h)))};
g.n(H2X,N5);H2X.prototype.W=function(){var h=[];this.X.owner&&h.push(this.X.owner);this.X.downloadState&&h.push(this.X.downloadState);this.X.userState&&h.push.apply(h,g.rN((new sH6(this.X.userState)).W()));this.X.additionalMetadata&&h.push.apply(h,g.rN((new $$6(this.X.additionalMetadata)).W()));return[].concat(g.rN(new Set(h)))};
g.n(B5U,N5);B5U.prototype.W=function(){var h=[];this.X.userChannelDetails&&h.push(this.X.userChannelDetails);return[].concat(g.rN(new Set(h)))};
g.n(E7f,N5);E7f.prototype.W=function(){var h=[];this.X.channelOwner&&h.push(this.X.channelOwner);this.X.playbackPosition&&h.push(this.X.playbackPosition);this.X.localImageEntities&&h.push.apply(h,g.rN(this.X.localImageEntities));this.X.downloadStatus&&h.push(this.X.downloadStatus);return[].concat(g.rN(new Set(h)))};
g.n(Rhc,N5);Rhc.prototype.W=function(){return[]};
g.n(JHX,N5);JHX.prototype.W=function(){return[]};
g.n(u7$,N5);u7$.prototype.W=function(){return[]};
g.n(d$U,N5);d$U.prototype.W=function(){return[]};
g.n(Gd2,N5);Gd2.prototype.W=function(){return[]};
g.n(Z2I,N5);Z2I.prototype.W=function(){return[]};
g.n(rHS,N5);rHS.prototype.W=function(){return[]};
g.n(q$6,N5);q$6.prototype.W=function(){return[]};
g.n(x$2,N5);x$2.prototype.W=function(){return[]};
g.n(lPf,N5);lPf.prototype.W=function(){return[]};
g.n(n7U,N5);n7U.prototype.W=function(){return[]};
g.n(jHS,N5);jHS.prototype.W=function(){return[]};
g.n(aPS,N5);aPS.prototype.W=function(){var h=[];this.X.trackDownloadMetadatas&&h.push.apply(h,g.rN(this.X.trackDownloadMetadatas));return[].concat(g.rN(new Set(h)))};
g.n(ehu,N5);
ehu.prototype.W=function(){var h=[];this.X.downloadedTracks&&h.push.apply(h,g.rN(this.X.downloadedTracks));this.X.smartDownloadedTracks&&h.push.apply(h,g.rN(this.X.smartDownloadedTracks));this.X.downloadedEpisodes&&h.push.apply(h,g.rN(this.X.downloadedEpisodes));this.X.downloadedAlbumReleases&&h.push.apply(h,g.rN(this.X.downloadedAlbumReleases));this.X.smartDownloadedAlbumReleases&&h.push.apply(h,g.rN(this.X.smartDownloadedAlbumReleases));this.X.downloadedPlaylists&&h.push.apply(h,g.rN(this.X.downloadedPlaylists));this.X.smartDownloadedPlaylists&&
h.push.apply(h,g.rN(this.X.smartDownloadedPlaylists));this.X.metadataOnlyTracks&&h.push.apply(h,g.rN(this.X.metadataOnlyTracks));return[].concat(g.rN(new Set(h)))};
g.n(zhS,N5);zhS.prototype.W=function(){var h=[];this.X.trackDownloadMetadatas&&h.push.apply(h,g.rN(this.X.trackDownloadMetadatas));return[].concat(g.rN(new Set(h)))};
g.n(QH6,N5);QH6.prototype.W=function(){var h=[];this.X.playbackData&&h.push(this.X.playbackData);this.X.localImageEntities&&h.push.apply(h,g.rN(this.X.localImageEntities));this.X.videoDownloadContextEntity&&h.push(this.X.videoDownloadContextEntity);return[].concat(g.rN(new Set(h)))};
g.n(Lmc,N5);Lmc.prototype.W=function(){var h=[];this.X.musicLibraryStatusEntity&&h.push(this.X.musicLibraryStatusEntity);this.X.primaryArtists&&h.push.apply(h,g.rN(this.X.primaryArtists));this.X.details&&h.push(this.X.details);this.X.userDetails&&h.push(this.X.userDetails);this.X.tracks&&h.push.apply(h,g.rN(this.X.tracks));this.X.share&&h.push(this.X.share);this.X.downloadMetadata&&h.push(this.X.downloadMetadata);this.X.refresh&&h.push(this.X.refresh);return[].concat(g.rN(new Set(h)))};
g.n(i26,N5);i26.prototype.W=function(){var h=[];this.X.albumRelease&&h.push(this.X.albumRelease);this.X.tracks&&h.push.apply(h,g.rN(this.X.tracks));return[].concat(g.rN(new Set(h)))};
g.n(Km2,N5);Km2.prototype.W=function(){var h=[];this.X.albumRelease&&h.push(this.X.albumRelease);return[].concat(g.rN(new Set(h)))};
g.n(AHU,N5);AHU.prototype.W=function(){var h=[];this.X.details&&h.push(this.X.details);this.X.userDetails&&h.push(this.X.userDetails);return[].concat(g.rN(new Set(h)))};
g.n(U$l,N5);U$l.prototype.W=function(){var h=[];this.X.parentArtist&&h.push(this.X.parentArtist);return[].concat(g.rN(new Set(h)))};
g.n(CH6,N5);CH6.prototype.W=function(){var h=[];this.X.parentArtist&&h.push(this.X.parentArtist);return[].concat(g.rN(new Set(h)))};
g.n(MxU,N5);MxU.prototype.W=function(){return[]};
g.n(FmU,N5);FmU.prototype.W=function(){return[]};
g.n(yHX,Tl);yHX.prototype.W=function(){var h=[];this.X.creatorEntity&&h.push(this.X.creatorEntity);return[].concat(g.rN(new Set(h)))};
g.n(PHU,N5);
PHU.prototype.W=function(){var h=[];this.X.tracks&&h.push.apply(h,g.rN(this.X.tracks));this.X.refresh&&h.push(this.X.refresh);this.X.musicLibraryStatusEntity&&h.push(this.X.musicLibraryStatusEntity);this.X.details&&h.push(this.X.details);this.X.downloadMetadata&&h.push(this.X.downloadMetadata);this.X.sideloadMetadata&&h.push(this.X.sideloadMetadata);this.X.userDetails&&h.push(this.X.userDetails);this.X.entryCollection&&h.push(this.X.entryCollection);this.X.share&&h.push(this.X.share);this.X.podcastShowAdditionalMetadata&&
h.push.apply(h,g.rN((new yHX(this.X.podcastShowAdditionalMetadata)).W()));return[].concat(g.rN(new Set(h)))};
g.n(fPc,N5);fPc.prototype.W=function(){return[]};
g.n(b2S,N5);
b2S.prototype.W=function(){var h=[];this.X.musicLibraryStatusEntity&&h.push(this.X.musicLibraryStatusEntity);this.X.artists&&h.push.apply(h,g.rN(this.X.artists));this.X.audioModeVersion&&h.push(this.X.audioModeVersion);this.X.videoModeVersion&&h.push(this.X.videoModeVersion);this.X.userDetails&&h.push(this.X.userDetails);this.X.details&&h.push(this.X.details);this.X.albumRelease&&h.push(this.X.albumRelease);this.X.share&&h.push(this.X.share);this.X.libraryEdit&&h.push(this.X.libraryEdit);this.X.downloadMetadata&&
h.push(this.X.downloadMetadata);this.X.playbackPosition&&h.push(this.X.playbackPosition);this.X.lyrics&&h.push(this.X.lyrics);return[].concat(g.rN(new Set(h)))};
g.n(T5U,N5);T5U.prototype.W=function(){var h=[];this.X.parentTrack&&h.push(this.X.parentTrack);return[].concat(g.rN(new Set(h)))};
g.n(N5f,N5);N5f.prototype.W=function(){var h=[];this.X.parentTrack&&h.push(this.X.parentTrack);return[].concat(g.rN(new Set(h)))};
g.n(XeU,N5);XeU.prototype.W=function(){return[]};
g.n(txU,N5);txU.prototype.W=function(){return[]};
g.n(v7l,N5);v7l.prototype.W=function(){return[]};
g.n(m$U,N5);m$U.prototype.W=function(){return[]};
g.n(o76,N5);o76.prototype.W=function(){var h=[];this.X.transfer&&h.push(this.X.transfer);this.X.adsPlaybackData&&h.push.apply(h,g.rN(this.X.adsPlaybackData));this.X.drmLicense&&h.push(this.X.drmLicense);this.X.offlineVideoPolicy&&h.push(this.X.offlineVideoPolicy);this.X.videoDownloadContextEntity&&h.push(this.X.videoDownloadContextEntity);return[].concat(g.rN(new Set(h)))};
g.n(pel,N5);pel.prototype.W=function(){return[]};
g.n(IP6,N5);IP6.prototype.W=function(){var h=[];this.X.offlineVideoStreams&&h.push.apply(h,g.rN(this.X.offlineVideoStreams));this.X.captionTrack&&h.push.apply(h,g.rN(this.X.captionTrack));return[].concat(g.rN(new Set(h)))};
g.n(Y$f,N5);Y$f.prototype.W=function(){return[]};
g.n(O2$,N5);O2$.prototype.W=function(){return[]};
g.n(S$6,N5);S$6.prototype.W=function(){return[]};
g.n(g7K,N5);g7K.prototype.W=function(){return[]};
g.n(D$X,N5);D$X.prototype.W=function(){return[]};
g.n(wel,N5);wel.prototype.W=function(){return[]};
g.n(kdl,N5);kdl.prototype.W=function(){return[]};
g.n(hXI,N5);hXI.prototype.W=function(){return[]};
g.n(W32,N5);W32.prototype.W=function(){return[]};
g.n(cF2,N5);cF2.prototype.W=function(){return[]};
g.n(VaK,N5);VaK.prototype.W=function(){return[]};
g.n($d6,N5);$d6.prototype.W=function(){return[]};
g.n(snf,N5);snf.prototype.W=function(){return[]};
g.n(HW$,N5);HW$.prototype.W=function(){return[]};
g.n(BmU,N5);BmU.prototype.W=function(){return[]};
g.n(Evf,N5);Evf.prototype.W=function(){return[]};
g.n(RXX,N5);RXX.prototype.W=function(){return[]};
g.n(JF2,N5);JF2.prototype.W=function(){return[]};
g.n(uvc,N5);uvc.prototype.W=function(){return[]};
g.n(ddU,N5);ddU.prototype.W=function(){return[]};
g.n(Gsl,N5);Gsl.prototype.W=function(){return[]};
var df6=["browse","music/browse","unplugged/browse"],xfU=["offline/playlist_sync_check"],VE6=["offline"],Gic=["offline/offline_video_playback_position_sync"],rjU=["offline/get_playback_data_entity"],X3;td.getInstance=function(){return g.P(function(h){return h.return(new Promise(function(W){g.IC().then(function(c){c?(td.instance||(td.instance=new td(c)),W(td.instance)):W(void 0)})}))})};
td.prototype.get=function(h){var W=this,c,V,H;return g.P(function(B){if(B.W==1)return g.F(B,xd6(W.token),2);if(B.W!=3)return c=B.X,g.F(B,c.get("prefs",h),3);V=B.X;if(!V)return B.return();H=(0,g.aC)();return V.expirationTimestampMs<=H?B.return():B.return(V.value)})};
td.prototype.set=function(h,W,c){c=c===void 0?31536E3:c;var V=this,H,B,E;return g.P(function(J){if(J.W==1)return H=(0,g.aC)(),B={key:h,value:W,expirationTimestampMs:H+c*1E3},g.F(J,xd6(V.token),2);E=J.X;return g.F(J,g.Kg(E,"prefs",B),0)})};
td.prototype.remove=function(h){var W=this,c;return g.P(function(V){if(V.W==1)return g.F(V,xd6(W.token),2);c=V.X;return g.F(V,c.delete("prefs",h),0)})};
g.n(vi,g.tP);g.n(mp,eX2);mp.prototype.G=function(h,W){W=Qn6(W);h=(new TextEncoder).encode(JSON.stringify(h));return this.X.encrypt(h,W)};
mp.prototype.W=function(h,W){if(!(h instanceof Uint8Array))throw l9u(1);var c=new TextDecoder;W=Qn6(W);h=this.X.decrypt(h,W);return JSON.parse(c.decode(h))};
var L3K={accountLinkStatusEntity:NxK,booleanEntity:UY6,buttonEntity:HW$,captionTrack:XeU,channelHandle:iR2,chipEntity:kdl,commerceAcquisitionClientPayloadEntity:Evf,commerceCartListEntity:RXX,contextNoteFeedEntityPayload:KL2,contextNoteUserRatingEntityPayload:AbU,continuationTokenEntity:hht,downloadQualityPickerEntity:mYI,downloadsPageRefreshTokenEntity:pUU,downloadsPageViewConfigurationEntity:Rhc,downloadStatusEntity:ofU,dismissState:hXI,sfvAudioItemCurrentlyPlayingEntity:g7K,emojiFountainDataEntity:$d6,
emojiCustomizationSetEntity:VaK,fakeChannel:Mel,fakePlaylist:FLl,fakePlaylistEntryCollection:PO$,fakeVideo:fkI,fakeVideoDescription:bRI,featuredProductsEntity:lPf,flowStateEntity:Tx$,iconBadgeEntity:JF2,interstitialInteractionStateEntity:te2,likeButtonAnimationEntity:JHX,liveChatPollStateEntity:vf$,liveViewerLeaderboardChatEntryPointStateEntity:O2$,liveViewerLeaderboardPointsEntity:S$6,liveReactionsDataEntity:snf,logoEntity:XUU,macroMarkerEntity:u7$,mainDownloadsLibraryEntity:Ik6,mainDownloadsListEntity:ORl,
mainPlaylistDownloadStateEntity:STX,mainPlaylistEntity:WmU,mainPlaylistVideoEntity:cHU,mainVideoDownloadStateEntity:gf2,mainVideoEntity:H2X,markersEngagementPanelSyncEntity:d$U,markersVisibilityOverrideEntity:Gd2,musicAlbumReleaseDetail:i26,musicAlbumReleaseDownloadMetadataEntity:aPS,musicAlbumRelease:Lmc,musicAlbumReleaseUserDetail:Km2,musicArtistDetail:U$l,musicArtist:AHU,musicArtistUserDetail:CH6,musicDownloadsLibraryEntity:ehu,musicLibraryEdit:MxU,musicLibraryStatusEntity:FmU,musicPlaylist:PHU,
musicPlaylistDownloadMetadataEntity:zhS,musicShare:fPc,musicTrackDetail:T5U,musicTrackDownloadMetadataEntity:QH6,musicTrack:b2S,musicTrackUserDetail:N5f,offlineOrchestrationActionWrapperEntity:txU,offlineVideoPolicy:v7l,offlineVideoStreams:m$U,offlineabilityEntity:DYX,orchestrationWebSamplingEntity:wUc,pageHeaderEntity:W32,pdpStateEntity:uvc,pinnedProductEntity:n7U,playbackData:o76,playerStateEntity:Z2I,quantityIncrementerEntity:ddU,refresh:pel,saveToPlaylistListEntity:D$X,selectedChipIndexEntityPayload:rHS,
settingEntity:wel,stringEntity:COU,suggestedFeedbackChipStateEntity:q$6,transfer:IP6,trendingOfferEntity:jHS,videoDownloadContextEntity:Y$f,videoOverviewAsyncDataEntity:Gsl,videoPlaybackPositionEntity:BmU,votingEntity:cF2,ytMainChannelEntity:B5U,youchatPendingResponseEntity:x$2,ytMainDownloadedVideoEntity:kuK,ytMainVideoEntity:E7f};g.n(Si,eX2);Si.prototype.G=function(h){return h};
Si.prototype.W=function(h){if(h instanceof Uint8Array)throw l9u(0);return h};
g.n(gq,g.N);gq.prototype.observe=function(h){var W=this;this.observers.push(h);return function(){var c=W.observers.indexOf(h);c>=0&&W.observers.splice(c,1)}};
gq.prototype.W=function(h){XK6(this,h.data)};
gq.prototype.dE=function(){this.channel.close()};
var pKX,mVU=new g.jn("elementsCommand");var Ld=new g.jn("entityBatchUpdate");var CdU=new g.jn("downloadStatusEntity");var Yb6=new g.jn("mainPlaylistEntityActionMetadata");var Dm=new g.jn("mainVideoEntityActionMetadata");var cjK=new g.jn("musicPlaylistEntityActionMetadata");var KPI=new g.jn("musicTrackEntityActionMetadata");var EZU=new g.jn("localImageEntityActionMetadata");var bk=new g.jn("playbackDataActionMetadata");var o$l=new g.jn("transferEntityActionMetadata");var Ajc=new g.jn("videoPlaybackPositionEntityActionMetadata");var Hel;new g.R_;new g.R_;uHc.prototype.request=function(h,W,c){W=W===void 0?{}:W;return this.locks.request(h,W,function(V){return c(V)})};var $m=g.k5.caches,VF,qEK;cZ.prototype.open=function(h){return $m.open(ZeI(h))};
cZ.prototype.has=function(h){return $m.has(ZeI(h))};
cZ.prototype.delete=function(h){return $m.delete(ZeI(h))};
cZ.prototype.match=function(h,W){var c=this,V,H,B,E,J,u;return g.P(function(d){switch(d.W){case 1:return g.F(d,c.keys(),2);case 2:V=d.X,H=g.e(V),B=H.next();case 3:if(B.done){d.bB(5);break}E=B.value;return g.F(d,c.open(E),6);case 6:return J=d.X,g.F(d,J.match(h,W),7);case 7:if(u=d.X)return d.return(u);B=H.next();d.bB(3);break;case 5:return d.return()}})};
g.n(GTU,cZ);GTU.prototype.keys=function(){var h,W,c,V,H,B,E,J,u;return g.P(function(d){if(d.W==1)return h=[],W=g.vt("CacheStorage keys"),g.F(d,$m.keys(),2);c=d.X;V=g.e(c);for(H=V.next();!H.done;H=V.next()){B=H.value;var G=B.indexOf(":");E=G===-1?{Mw:B}:{Mw:B.substring(0,G),datasyncId:B.substring(G+1)};J=E.Mw;u=E.datasyncId;u===W&&h.push(J)}return d.return(h)})};g.n(HZ,g.N);HZ.prototype.G=function(h){this.api.Iz("onOfflineOperationFailure",h.data)};
HZ.prototype.Y=function(h){this.api.publish("offlinetransferpause",h.data)};
HZ.prototype.dE=function(){var h;(h=this.X)==null||h.close();var W;(W=this.W)==null||W.close()};nQI.prototype.RV=function(){this.X&&EU(this)};
nQI.prototype.LK=function(){this.W&&this.W.resolve();this.G=this.X=!1;this.T()};var Hc$=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var X9l="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var DVu="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.n(n$c,yF);n$c.prototype.W=function(h){return dB(h)?e5f(this,h):Gg(h)?Ls6(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};g.n(iO2,yF);iO2.prototype.W=function(h){return Gg(h)?Kst(this,h):UVf(h)?Uf2(this,h):Zm(h)?Cel(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};g.l=MEI.prototype;g.l.uAM=function(h){var W=this,c,V,H,B;return g.P(function(E){if(!g.Y(h.state,128))return E.bB(0);c=h.state.FK;var J=(V=c)==null?void 0:V.errorCode,u=(H=c)==null?void 0:H.mz;B=J==="net.connect"&&u===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(J==null?0:J.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.F(E,W.LX(W.player.getVideoData().videoId,B),0)})};
g.l.LX=function(h,W){var c=this;return g.P(function(V){if(V.W==1){if(c.W)return V.return();c.W=!0;return W==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Xf(c,h,!1,!0),V.bB(0)):g.F(V,NR(c,h),3)}g.hT(h,4);return g.F(V,c.X.LX(W),0)})};
g.l.Fc=function(h){h.status===2?(h.status!==this.G&&(KWl(this.X),g.hT(h.videoId,2)),h.WF&&FW2(this.X,h.videoId,h.WF)):h.status===4?(NR(this,h.videoId),this.LX(h.videoId,h.Qn?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):h.status===1&&MQI(this.X);this.G=h.status;this.api.Iz("localmediachange",{videoId:h.videoId,status:h.status})};
g.l.Eg=function(){var h=this,W;return g.P(function(c){if(c.W==1){if(h.W)return c.return();h.W=!0;W=h.player.getVideoData().videoId;return g.F(c,NR(h,W),2)}return g.F(c,h.X.Eg(),0)})};
g.l.mq=function(h){switch(h){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.l.j=function(h){return this.api.B().j(h)};g.n(NHf,yF);NHf.prototype.W=function(h){return dB(h)?tEK(this,h):Gg(h)?v$6(this,h):UVf(h)?mfU(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};S56.prototype.X=function(h,W){var c=h.action.actionMetadata.priority-W.action.actionMetadata.priority;c===0&&(h.X<W.X?c=-1:h.X>W.X&&(c=1));return c};g.n(tf,g.N);tf.prototype.dE=function(){this.T&&this.T();g.N.prototype.dE.call(this)};
tf.prototype.createAction=function(h,W){var c=g.pP(h.entityKey).entityType,V=g.Ge(16);return new nd(c,V,h,W.actionId,W.rootActionId)};
tf.prototype.Wk=function(h){var W=this,c,V,H,B,E,J,u,d,G;return g.P(function(Z){if(Z.W==1){if(W.gE())return Z.return();V=(c=h.offlineOrchestrationActionWrapperEntity)!=null?c:new Set;H=[];B=g.e(V);for(E=B.next();!E.done;E=B.next())J=E.value,u=g.pP(J),d=u.entityId,wy6(W.X,d)||H.push(J);return g.F(Z,Rpl(W,H),2)}G=Z.X;return g.F(Z,Ey6(W,G),0)})};
tf.prototype.retry=function(){var h=this;return g.P(function(W){return g.F(W,Je2(h),0)})};dM$.prototype.UJ=function(h,W){W=W===void 0?!0:W;var c=this,V,H,B,E,J,u,d,G;return g.P(function(Z){switch(Z.W){case 1:if(!c.X)return Z.return();V=[];H=g.Bv(c.X.W,W);B=[];for(E={Jr:0};E.Jr<H.length;E={Jr:E.Jr},E.Jr++)J=H[E.Jr],u=c.X.Yi(J,"json3"),d=g.zN(u,{withCredentials:!0,format:"RAW"},3,500).then(function(r){return function(q){q={metadata:g.Nc(H[r.Jr]),trackData:q.xhr.responseText};B.push(q)}}(E)).Mv(function(r){sU("Caption fetch error",r)}),V.push(d);
return g.F(Z,LL6(V),2);case 2:return g.Qp(Z,3),g.F(Z,ksu(h,B),5);case 5:g.AN(Z,0);break;case 3:G=g.CU(Z),sU("Caption DB transaction error",G),g.zQ(Z)}})};g.n(vZ,g.N);vZ.prototype.dE=function(){this.W&&this.W();g.N.prototype.dE.call(this)};
vZ.prototype.G=function(h){var W=this,c,V,H,B,E,J,u,d;return g.P(function(G){V=(c=h.transfer)!=null?c:new Set;H=[];B=g.e(V);for(E=B.next();!E.done;E=B.next())J=E.value,u=g.pP(J),d=u.entityId,H.push(d);return H.length===0?G.return():g.F(G,reU(W,H),0)})};g.n(jr6,g.N);g.l=jr6.prototype;g.l.dE=function(){this.Pk&&this.Pk();this.DH.dispose();this.Y.dispose();this.Nn&&g.O$(this.N.Dk,this.Nn);this.mW&&g.O$(this.N.Dk,this.mW);g.N.prototype.dE.call(this)};
g.l.U$O=function(h){var W=this,c,V,H;return g.P(function(B){switch(B.W){case 1:c=g.Ib(h,"transfer");if(W.X&&c===W.X.key){Xf(W.S,W.C,!0);W.Y.stop();B.bB(0);break}return g.F(B,Di(W.W,{mode:"readwrite",nJ:!0},function(E){return oh(E,c,"transfer").then(function(J){if(J&&J.transferState!=="TRANSFER_STATE_COMPLETE"&&J.transferState!=="TRANSFER_STATE_FAILED")return J.transferState="TRANSFER_STATE_PAUSED_BY_USER",Yi(E,J,"transfer").then(function(){return J})})}),3);
case 3:V=B.X;if(!V){B.bB(0);break}if(!h||!W.G){B.bB(5);break}return g.F(B,rB(h,W.G,W.W,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.F(B,pd(W,h),7);case 7:H=B.X,KVU({videoId:h,p$:V,offlineModeType:H}),g.zQ(B)}})};
g.l.sTV=function(){var h=this;if(this.X&&this.C){Xf(this.S,this.C,!1);var W=this.X,c=(W==null?0:W.key)?g.pP(W.key).entityId:"";c&&this.G&&(new Promise(function(V,H){rB(c,h.G,h.W,"DOWNLOAD_STATE_PAUSED").catch(function(B){H(B)})})).catch(function(V){sU("Download state setting error",V)})}this.Y.stop()};
g.l.F3=function(){this.X?zpS(this,this.X):oF(this)};
g.l.N4=function(h){var W=this;return g.P(function(c){switch(c.W){case 1:if(!W.X){c.bB(2);break}if(W.X.transferState==="TRANSFER_STATE_COMPLETE"||W.X.transferState==="TRANSFER_STATE_FAILED"||!h.transfer||!h.transfer.has(W.X.key)){c.bB(3);break}return g.F(c,ki(W.W,W.X.key,"transfer"),4);case 4:W.X=c.X;if(W.X){c.bB(3);break}return g.F(c,Qr6(W),3);case 3:if(W.X)return c.return();case 2:return g.F(c,oF(W),0)}})};
g.l.LX=function(h,W){var c=this,V,H,B,E,J;return g.P(function(u){switch(u.W){case 1:if(!c.X){IF(c,"onTransferFailure: "+h);u.bB(2);break}V=c.X;B=((H=V)==null?0:H.key)?g.pP(V.key).entityId:"";a:switch(h){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var d=!1;break a;default:d=!0}return d&&yeS(c)?g.F(u,Ym(c,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.F(u,
P2$(c,h),5);case 5:if(!B||!c.G){u.bB(2);break}return g.F(u,rB(B,c.G,c.W,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.F(u,pd(c,B),9);case 9:E=u.X;Jf({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:B,p$:V,offlineModeType:E});if(!B||!c.G){u.bB(2);break}return g.F(u,rB(B,c.G,c.W,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:mT(c),J=oF(c,!0),W&&W(J),g.zQ(u)}})};
g.l.Eg=function(h){var W=this,c,V,H,B,E,J,u,d,G,Z,r,q;return g.P(function(x){switch(x.W){case 1:if(!W.X){IF(W,"onMaybeTransferStreamsExpired");x.bB(2);break}return yeS(W)?g.F(x,Ym(W,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.F(x,P2$(W,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!W.G){x.bB(2);break}c=W.X;H=((V=c)==null?0:V.key)?g.pP(c.key).entityId:"";if(!H){x.bB(2);break}return g.F(x,rB(H,W.G,W.W,"DOWNLOAD_STATE_FAILED"),2);case 9:return W.X||IF(W,"onMaybeTransferStreamsExpiredRetryAttempting"),
B=W.X,J=((E=B)==null?0:E.key)?g.pP(B.key).entityId:"",g.F(x,pd(W,J),10);case 10:return u=x.X,Jf({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:J,p$:B,offlineModeType:u}),d=yE6(),g.Cx(d,bk,{isEnqueuedForExpiredStreamUrlRefetch:!0}),G=g.Ib(J,"playbackData"),Z={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:G,actionMetadata:d},r=aF(new nd("playbackData",J,Z)),g.F(x,wq(W.W,r,"offlineOrchestrationActionWrapperEntity"),2);case 2:mT(W),q=oF(W,!0),
h&&h(q),g.zQ(x)}})};
var NO6={},f_K=(NO6.TRANSFER_STATE_TRANSFERRING=1,NO6.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,NO6);g.l=OU.prototype;g.l.RH=function(){return this.C.promise};
g.l.eF=function(){if(this.W&&this.S)return this.C.promise;NSc(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise};
g.l.w2=function(h){var W={};return W.playbackData=new n$c(h,this.uB,this.X),W.transfer=new NHf(h,this.uB),W.videoPlaybackPositionEntity=new iO2(h,this.uB),W};
g.l.YY=function(){var h=this;return g.P(function(W){return h.W?g.F(W,a_U(h.W),0):W.bB(0)})};
g.l.AV=function(){var h=this,W,c;return g.P(function(V){if(V.W==1)return h.W||h.S?g.F(V,h.RH(),2):V.return();h.Z!==void 0&&(g.dJ(h.Z),h.Z=void 0);h.Y!==void 0&&(g.dJ(h.Y),h.Y=void 0);(W=h.W)==null||W.dispose();h.W=void 0;(c=h.S)==null||c.dispose();h.S=void 0;h.api.Iz("onOrchestrationLostLeader");h.C=new g.R_;g.zQ(V)})};
g.l.isOrchestrationLeader=function(){return this.G.X};
g.l.Qc=function(){return g.P(function(h){return h.return(!1)})};
g.l.m2=function(h){var W=this.X;W.api.publish("offlinetransferpause",h);var c;(c=W.W)==null||c.postMessage(h)};
g.l.F3=function(h){var W,c;return g.P(function(V){if(V.W==1)return g.F(V,WZ(),2);W=V.X;if(!W)return V.return();c=g.Ib(h,"transfer");return g.F(V,Di(W,{mode:"readwrite",nJ:!0},function(H){var B=oh(H,c,"transfer"),E=oh(H,g.Ib(h,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.x4.all([B,E]).then(function(J){J=g.e(J);var u=J.next().value;var d=J.next().value;return u&&u.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(u.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Yi(H,u,"transfer").then(function(){Jf({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:h,p$:u,offlineModeType:d==null?void 0:d.offlineModeType});return g.x4.resolve(null)})):g.x4.resolve(null)})}),0)})};
g.l.M_=function(h){h=h===void 0?43200:h;var W=this,c,V,H,B,E,J,u,d;return g.P(function(G){if(G.W==1)return W.N.zj()?g.F(G,WZ(),2):G.return(XDu());if(G.W!=3){c=G.X;if(!c)return G.return([]);V=Date.now()/1E3;return g.F(G,hf(c,"offlineVideoPolicy"),3)}H=G.X;B=[];E=g.e(H);for(J=E.next();!J.done;J=E.next())u=J.value,Number(u.lastUpdatedTimestampSeconds)+h<=V&&(d=g.pP(u.key).entityId,B.push(d));return B.length?G.return(Sh(W,B,W.T,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):G.return([])})};
g.l.deleteAll=function(){return Sh(this,["!*$_ALL_ENTITIES_!*$"],this.T,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.l.refreshAllStaleEntities=function(h){var W=this;return g.P(function(c){return c.W==1?g.F(c,W.M_(h),2):c.return(c.X)})};
g.l.setUpPositionSyncInterval=function(h){var W=this;this.Y!==void 0&&(g.dJ(this.Y),this.Y=void 0);var c=h!=null?h:864E5;this.Y=g.Jc(function(){W.aW(c)},c)};
g.l.aW=function(h){var W=this,c,V,H,B,E,J;return g.P(function(u){switch(u.W){case 1:return g.Qp(u,2),g.F(u,td.getInstance(),4);case 4:c=u.X;if(!c)throw Error("prefStorage is undefined");return g.F(u,c.get("psi"),5);case 5:V=u.X;B=((H=V)==null?0:H.pV)?Number(V.pV)/1E3:0;E=Date.now();if(!(B+h<=E)){u.bB(6);break}return g.F(u,Sh(W,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.AN(u,0);break;case 2:J=g.CU(u),sU("Offline manager error",J),
g.zQ(u)}})};
g.l.Xr=function(){var h=this,W,c,V,H,B,E,J;return g.P(function(u){if(u.W==1)return g.F(u,WZ(),2);if(u.W!=3)return(W=u.X)?g.F(u,hf(W,"transfer"),3):u.return([]);c=u.X;V=[];H=g.e(c);for(B=H.next();!B.done;B=H.next())E=B.value,E.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&E.key&&(J=g.pP(E.key).entityId,V.push(J));return u.return(vyc(h,V))})};
g.l.hH=function(){return g.P(function(h){return h.return([])})};
g.l.GN=function(){return g.P(function(h){g.zQ(h)})};
g.l.CB=function(){return g.P(function(h){g.zQ(h)})};g.n(mMS,yF);mMS.prototype.W=function(h){return dB(h)?I_I(this,h):Gg(h)?Oct(this,h):Zm(h)?Sb2(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var gB=[10];g.n(hHU,yF);hHU.prototype.W=function(h){return dB(h)?Vnu(this,h):Gg(h)?$Uc(this,h):Zm(h)?sWt(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var ct2=[10];g.n(BOX,yF);BOX.prototype.W=function(h){return Gg(h)?RHS(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};g.n(JtU,OU);g.l=JtU.prototype;g.l.w2=function(h){var W=OU.prototype.w2.call(this,h);W.mainVideoEntity=new hHU(h,this.uB,this.X);W.mainPlaylistEntity=new mMS(h,this.uB,this.X);W.mainDownloadsListEntity=new BOX(h,this.uB,this.X);return W};
g.l.refreshAllStaleEntities=function(h,W){var c=this,V,H,B,E,J,u,d,G,Z,r,q;return g.P(function(x){switch(x.W){case 1:V=[];if(!c.uB.j("web_player_offline_playlist_auto_refresh")){x.bB(2);break}return g.F(x,u_$(c,h,W),3);case 3:V=x.X;case 2:return g.F(x,td.getInstance(),4);case 4:return H=x.X,g.F(x,(B=H)==null?void 0:B.get("sdois"),5);case 5:return E=x.X,g.F(x,(J=H)==null?void 0:J.get("lmqf"),6);case 6:u=x.X;if(!E){x.bB(7);break}G=V;Z=G.concat;return g.F(x,dUX(c,E,(d=u)!=null?d:"SD",h===0),8);case 8:V=
Z.call(G,x.X);case 7:return r=V,q=r.concat,g.F(x,OU.prototype.refreshAllStaleEntities.call(c,h,W),9);case 9:return V=q.call(r,x.X),x.return(V)}})};
g.l.Qc=function(h){var W,c,V,H,B,E,J,u;return g.P(function(d){if(d.W==1)return g.F(d,WZ(),2);if(d.W!=3)return(W=d.X)?g.F(d,ki(W,g.vC,"mainDownloadsListEntity"),3):d.return(!1);c=d.X;if((V=c)==null?0:(H=V.downloads)==null?0:H.length)for(B=g.Ib(h,"mainVideoEntity"),E=g.e(c.downloads),J=E.next();!J.done;J=E.next())if(u=J.value,u.videoItem===B)return d.return(!0);return d.return(!1)})};
g.l.hH=function(){var h=this,W,c,V,H,B,E,J,u;return g.P(function(d){if(d.W==1)return g.F(d,WZ(),2);if(d.W!=3)return(W=d.X)?g.F(d,hf(W,"downloadStatusEntity"),3):d.return([]);c=d.X;V=[];H=g.e(c);for(B=H.next();!B.done;B=H.next())E=B.value,E.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&E.key&&(J=g.pP(E.key).entityId,V.push(J));return V.length?(u={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},d.return(Sh(h,V,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
u))):d.return([])})};
g.l.CB=function(){var h;return g.P(function(W){return W.W==1?g.F(W,WZ(),2):(h=W.X)?g.F(W,Di(h,{mode:"readwrite",nJ:!0},function(c){return ph(c,"mainVideoEntity").then(function(V){var H=[];V=g.e(V);for(var B=V.next();!B.done;B=V.next()){B=B.value;var E=void 0;(E=B.userState)!=null&&E.playbackPosition||(E=g.pP(B.key).entityId,E={key:g.Ib(E,"videoPlaybackPositionEntity"),videoId:E,lastPlaybackPositionSeconds:"0"},H.push(Yi(c,E,"videoPlaybackPositionEntity")),B.userState={playbackPosition:E.key},H.push(Yi(c,
B,"mainVideoEntity")))}return g.x4.all(H)})}),0):W.return()})};
g.l.GN=function(){var h,W,c,V,H,B,E,J,u,d,G,Z,r,q,x,z,L,M,U,y,T,m,D,O,Bd,qL,Rk,JN,Wd,Uv,gN,W2,lK,Rf,Fl,BG,Tt,p$;return g.P(function(EO){if(EO.W==1)return g.F(EO,WZ(),2);if(EO.W!=3){h=EO.X;if(!h)return EO.return();W=g.Ib("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.F(EO,Di(h,{mode:"readonly",nJ:!0},function(C){return g.x4.all([oh(C,W,"mainDownloadsListEntity"),oh(C,g.vC,"mainDownloadsListEntity"),ph(C,"mainVideoEntity"),ph(C,"mainPlaylistEntity")])}),3)}c=EO.X;
V=g.e(c);H=V.next().value;B=V.next().value;E=V.next().value;J=V.next().value;u=H;d=B;G=E;Z=J;r=new Set;if((q=u)==null?0:(x=q.downloads)==null?0:x.length)for(z=g.e(u.downloads),L=z.next();!L.done;L=z.next())M=L.value,U=void 0,(y=(U=M.videoItem)!=null?U:M.playlistItem)&&r.add(y);if((T=d)==null?0:(m=T.downloads)==null?0:m.length)for(D=g.e(d.downloads),O=D.next();!O.done;O=D.next())Bd=O.value,Bd.videoItem&&r.add(Bd.videoItem);qL=new Set;Rk=[];JN=g.e(Z);for(Wd=JN.next();!Wd.done;Wd=JN.next()){Uv=Wd.value;
if(Uv.videos)for(gN=g.e(Uv.videos),W2=gN.next();!W2.done;W2=gN.next())lK=W2.value,(Rf=JSON.parse(g.pP(lK).entityId).videoId)&&qL.add(Rf);Uv.key&&!r.has(Uv.key)&&Rk.push(Uv.key)}Fl=g.e(G);for(BG=Fl.next();!BG.done;BG=Fl.next())Tt=BG.value,Tt.key&&!r.has(Tt.key)&&(p$=g.pP(Tt.key).entityId,qL.has(p$)||Rk.push(Tt.key));return Rk.length?g.F(EO,YEU(h,Rk),0):EO.bB(0)})};g.n(G7l,yF);G7l.prototype.W=function(h){return dB(h)?rtl(this,h):Gg(h)?q_6(this,h):Zm(h)?xUU(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var wB=[10];g.n(nZ6,yF);nZ6.prototype.W=function(h){return dB(h)?a3I(this,h):Gg(h)?eH6(this,h):Zm(h)?zHS(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var km=[10];g.n(iut,yF);iut.prototype.W=function(h){return dB(h)?C$I(this,h):Gg(h)?Mn6(this,h):Zm(h)?FP2(this,h):Promise.reject(Error("Unsupported action type: "+h.actionType))};
var UUt=[10];g.n(hi,OU);hi.prototype.w2=function(h){var W=OU.prototype.w2.call(this,h);W.musicTrack=new iut(h,this.X);W.musicPlaylist=new nZ6(h,this.X);W.musicAlbumRelease=new G7l(h,this.X);return W};
hi.prototype.refreshAllStaleEntities=function(h,W){var c=this,V,H,B;return g.P(function(E){if(E.W==1)return g.F(E,P$f(c,h,W),2);if(E.W!=3)return H=V=E.X,B=H.concat,g.F(E,OU.prototype.refreshAllStaleEntities.call(c,h,W),3);V=B.call(H,E.X);return E.return(V)})};g.n(f3I,g.K3);g.l=f3I.prototype;g.l.create=function(){var h=this;g.X(this,this.events);if(g.lo(this.uB))this.X=new JtU(this.uB,this.player);else if(g.CV(this.uB)||g.jz(this.uB))this.X=new hi(this.uB,this.player);this.events.U(this.player,"onPlaybackStartExternal",function(){h.vQ()});
this.events.U(this.player,"videodatachange",function(){h.vQ()});
this.uB.j("html5_offline_playback_position_sync")&&this.events.U(this.player,"presentingplayerstatechange",this.uM)};
g.l.xe=function(){return!1};
g.l.U$=function(h,W,c,V){var H=this;return g.P(function(B){return H.X?B.return(Sh(H.X,h,W,c,V)):B.return(Promise.reject())})};
g.l.deleteAll=function(){return this.X.deleteAll()};
g.l.M_=function(h){return this.X.M_(h)};
g.l.refreshAllStaleEntities=function(h){return this.X.refreshAllStaleEntities(h)};
g.l.setUpPositionSyncInterval=function(h){this.X.setUpPositionSyncInterval(h)};
g.l.m2=function(h){this.X.m2(h)};
g.l.F3=function(h){return this.X.F3(h)};
g.l.vQ=function(){var h=this,W;return g.P(function(c){W=h.player.getVideoData();return g.Gr(W)?buU(W)&&h.W!==W.clientPlaybackNonce?g.F(c,TOI(h,W),0):c.bB(0):c.return()})};
g.l.uM=function(h){var W=this,c,V,H,B,E,J,u;return g.P(function(d){if(d.W==1)return c=W.player.getVideoData(),V=c.q$,g.EA(h,2)||g.EA(h,512)?g.F(d,WZ(),2):d.return();if(d.W!=3){H=d.X;if(!H)return sU("PES is undefined"),d.return();B=c.videoId;return g.F(d,ki(H,g.Ib(B,"mainVideoEntity"),"mainVideoEntity"),3)}E=d.X;if(!E)return d.return();J=Math.floor(V).toString();u={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:J}};return g.F(d,W.U$([B],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
u),0)})};
g.l.isOrchestrationLeader=function(){return this.X.isOrchestrationLeader()};
g.l.updateDownloadState=function(h,W){var c,V,H,B;return g.P(function(E){if(E.W==1)return g.F(E,WZ(),2);c=E.X;if(!c)return sU("PES is undefined"),E.return();V=g.pP(h);H=V.entityType;B=V.entityId;return g.F(E,rB(B,H,c,W,!0),0)})};g.i3("offline",f3I);})(_yt_player);
